{"/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/test.js":"/* istanbul instrument in package npmtest_express_restify_mongoose */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        switch (local.modeJs) {\n        // re-init local from window.local\n        case 'browser':\n            local = local.global.utility2.objectSetDefault(\n                local.global.utility2_rollup || local.global.local,\n                local.global.utility2\n            );\n            break;\n        // re-init local from example.js\n        case 'node':\n            local = (local.global.utility2_rollup || require('utility2'))\n                .requireExampleJsFromReadme();\n            break;\n        }\n        // export local\n        local.global.local = local;\n    }());\n\n\n\n    // run shared js-env code - function\n    (function () {\n        return;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // run browser js-env code - function\n    case 'browser':\n        break;\n\n\n\n    // run node js-env code - function\n    case 'node':\n        break;\n    }\n\n\n\n    // run shared js-env code - post-init\n    (function () {\n        return;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // run browser js-env code - post-init\n    case 'browser':\n        // run tests\n        local.nop(local.modeTest &&\n            document.querySelector('#testRunButton1') &&\n            document.querySelector('#testRunButton1').click());\n        break;\n\n\n\n    // run node js-env code - post-init\n    /* istanbul ignore next */\n    case 'node':\n        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildApidoc's default handling-behavior-behavior\n         */\n            options = { modulePathList: module.paths };\n            local.buildApidoc(options, onError);\n        };\n\n        local.testCase_buildApp_default = local.testCase_buildApp_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildApp's default handling-behavior-behavior\n         */\n            local.testCase_buildReadme_default(options, local.onErrorThrow);\n            local.testCase_buildLib_default(options, local.onErrorThrow);\n            local.testCase_buildTest_default(options, local.onErrorThrow);\n            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);\n            options = [];\n            local.buildApp(options, onError);\n        };\n\n        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||\n            function (options, onError) {\n            /*\n             * this function will test buildCustomOrg's default handling-behavior\n             */\n                options = {};\n                local.buildCustomOrg(options, onError);\n            };\n\n        local.testCase_buildLib_default = local.testCase_buildLib_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildLib's default handling-behavior\n         */\n            options = {};\n            local.buildLib(options, onError);\n        };\n\n        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildReadme's default handling-behavior-behavior\n         */\n            options = {};\n            local.buildReadme(options, onError);\n        };\n\n        local.testCase_buildTest_default = local.testCase_buildTest_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildTest's default handling-behavior\n         */\n            options = {};\n            local.buildTest(options, onError);\n        };\n\n        local.testCase_webpage_default = local.testCase_webpage_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test webpage's default handling-behavior\n         */\n            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };\n            local.browserTest(options, onError);\n        };\n\n        // run test-server\n        local.testRunServer(local);\n        break;\n    }\n}());\n","/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/lib.npmtest_express_restify_mongoose.js":"/* istanbul instrument in package npmtest_express_restify_mongoose */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        // init utility2_rollup\n        local = local.global.utility2_rollup || local;\n        // init lib\n        local.local = local.npmtest_express_restify_mongoose = local;\n        // init exports\n        if (local.modeJs === 'browser') {\n            local.global.utility2_npmtest_express_restify_mongoose = local;\n        } else {\n            module.exports = local;\n            module.exports.__dirname = __dirname;\n            module.exports.module = module;\n        }\n    }());\n}());\n","/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/example.js":"/*\nexample.js\n\nquickstart example\n\ninstruction\n    1. save this script as example.js\n    2. run the shell command:\n        $ npm install npmtest-express-restify-mongoose && PORT=8081 node example.js\n    3. play with the browser-demo on http://127.0.0.1:8081\n*/\n\n\n\n/* istanbul instrument in package npmtest_express_restify_mongoose */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        // init utility2_rollup\n        local = local.global.utility2_rollup || (local.modeJs === 'browser'\n            ? local.global.utility2_npmtest_express_restify_mongoose\n            : global.utility2_moduleExports);\n        // export local\n        local.global.local = local;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // post-init\n    // run browser js-env code - post-init\n    /* istanbul ignore next */\n    case 'browser':\n        local.testRunBrowser = function (event) {\n            if (!event || (event &&\n                    event.currentTarget &&\n                    event.currentTarget.className &&\n                    event.currentTarget.className.includes &&\n                    event.currentTarget.className.includes('onreset'))) {\n                // reset output\n                Array.from(\n                    document.querySelectorAll('body > .resettable')\n                ).forEach(function (element) {\n                    switch (element.tagName) {\n                    case 'INPUT':\n                    case 'TEXTAREA':\n                        element.value = '';\n                        break;\n                    default:\n                        element.textContent = '';\n                    }\n                });\n            }\n            switch (event && event.currentTarget && event.currentTarget.id) {\n            case 'testRunButton1':\n                // show tests\n                if (document.querySelector('#testReportDiv1').style.display === 'none') {\n                    document.querySelector('#testReportDiv1').style.display = 'block';\n                    document.querySelector('#testRunButton1').textContent =\n                        'hide internal test';\n                    local.modeTest = true;\n                    local.testRunDefault(local);\n                // hide tests\n                } else {\n                    document.querySelector('#testReportDiv1').style.display = 'none';\n                    document.querySelector('#testRunButton1').textContent = 'run internal test';\n                }\n                break;\n            // custom-case\n            default:\n                break;\n            }\n            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&\n                    event.currentTarget &&\n                    event.currentTarget.className &&\n                    event.currentTarget.className.includes &&\n                    event.currentTarget.className.includes('oneval')))) {\n                // try to eval input-code\n                try {\n                    /*jslint evil: true*/\n                    eval(document.querySelector('#inputTextareaEval1').value);\n                } catch (errorCaught) {\n                    console.error(errorCaught);\n                }\n            }\n        };\n        // log stderr and stdout to #outputTextareaStdout1\n        ['error', 'log'].forEach(function (key) {\n            console[key + '_original'] = console[key];\n            console[key] = function () {\n                var element;\n                console[key + '_original'].apply(console, arguments);\n                element = document.querySelector('#outputTextareaStdout1');\n                if (!element) {\n                    return;\n                }\n                // append text to #outputTextareaStdout1\n                element.value += Array.from(arguments).map(function (arg) {\n                    return typeof arg === 'string'\n                        ? arg\n                        : JSON.stringify(arg, null, 4);\n                }).join(' ') + '\\n';\n                // scroll textarea to bottom\n                element.scrollTop = element.scrollHeight;\n            };\n        });\n        // init event-handling\n        ['change', 'click', 'keyup'].forEach(function (event) {\n            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {\n                element.addEventListener(event, local.testRunBrowser);\n            });\n        });\n        // run tests\n        local.testRunBrowser();\n        break;\n\n\n\n    // run node js-env code - post-init\n    /* istanbul ignore next */\n    case 'node':\n        // export local\n        module.exports = local;\n        // require modules\n        local.fs = require('fs');\n        local.http = require('http');\n        local.url = require('url');\n        // init assets\n        local.assetsDict = local.assetsDict || {};\n        /* jslint-ignore-begin */\n        local.assetsDict['/assets.index.template.html'] = '\\\n<!doctype html>\\n\\\n<html lang=\"en\">\\n\\\n<head>\\n\\\n<meta charset=\"UTF-8\">\\n\\\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\\n<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\\n<style>\\n\\\n/*csslint\\n\\\n    box-sizing: false,\\n\\\n    universal-selector: false\\n\\\n*/\\n\\\n* {\\n\\\n    box-sizing: border-box;\\n\\\n}\\n\\\nbody {\\n\\\n    background: #dde;\\n\\\n    font-family: Arial, Helvetica, sans-serif;\\n\\\n    margin: 2rem;\\n\\\n}\\n\\\nbody > * {\\n\\\n    margin-bottom: 1rem;\\n\\\n}\\n\\\n.utility2FooterDiv {\\n\\\n    margin-top: 20px;\\n\\\n    text-align: center;\\n\\\n}\\n\\\n</style>\\n\\\n<style>\\n\\\n/*csslint\\n\\\n*/\\n\\\ntextarea {\\n\\\n    font-family: monospace;\\n\\\n    height: 10rem;\\n\\\n    width: 100%;\\n\\\n}\\n\\\ntextarea[readonly] {\\n\\\n    background: #ddd;\\n\\\n}\\n\\\n</style>\\n\\\n</head>\\n\\\n<body>\\n\\\n<!-- utility2-comment\\n\\\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\\nutility2-comment -->\\n\\\n<h1>\\n\\\n<!-- utility2-comment\\n\\\n    <a\\n\\\n        {{#if env.npm_package_homepage}}\\n\\\n        href=\"{{env.npm_package_homepage}}\"\\n\\\n        {{/if env.npm_package_homepage}}\\n\\\n        target=\"_blank\"\\n\\\n    >\\n\\\nutility2-comment -->\\n\\\n        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\\n<!-- utility2-comment\\n\\\n    </a>\\n\\\nutility2-comment -->\\n\\\n</h1>\\n\\\n<h3>{{env.npm_package_description}}</h3>\\n\\\n<!-- utility2-comment\\n\\\n<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\\n<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\\n<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\\nutility2-comment -->\\n\\\n\\n\\\n\\n\\\n\\n\\\n<label>stderr and stdout</label>\\n\\\n<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\\n<!-- utility2-comment\\n\\\n{{#if isRollup}}\\n\\\n<script src=\"assets.app.js\"></script>\\n\\\n{{#unless isRollup}}\\n\\\nutility2-comment -->\\n\\\n<script src=\"assets.utility2.rollup.js\"></script>\\n\\\n<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\\n<script src=\"assets.npmtest_express_restify_mongoose.rollup.js\"></script>\\n\\\n<script src=\"assets.example.js\"></script>\\n\\\n<script src=\"assets.test.js\"></script>\\n\\\n<!-- utility2-comment\\n\\\n{{/if isRollup}}\\n\\\nutility2-comment -->\\n\\\n<div class=\"utility2FooterDiv\">\\n\\\n    [ this app was created with\\n\\\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\\n    ]\\n\\\n</div>\\n\\\n</body>\\n\\\n</html>\\n\\\n';\n        /* jslint-ignore-end */\n        if (local.templateRender) {\n            local.assetsDict['/'] = local.templateRender(\n                local.assetsDict['/assets.index.template.html'],\n                {\n                    env: local.objectSetDefault(local.env, {\n                        npm_package_description: 'the greatest app in the world!',\n                        npm_package_name: 'my-app',\n                        npm_package_nameAlias: 'my_app',\n                        npm_package_version: '0.0.1'\n                    })\n                }\n            );\n        } else {\n            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']\n                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {\n                    // jslint-hack\n                    String(match0);\n                    switch (match1) {\n                    case 'npm_package_description':\n                        return 'the greatest app in the world!';\n                    case 'npm_package_name':\n                        return 'my-app';\n                    case 'npm_package_nameAlias':\n                        return 'my_app';\n                    case 'npm_package_version':\n                        return '0.0.1';\n                    }\n                });\n        }\n        // run the cli\n        if (local.global.utility2_rollup || module !== require.main) {\n            break;\n        }\n        local.assetsDict['/assets.example.js'] =\n            local.assetsDict['/assets.example.js'] ||\n            local.fs.readFileSync(__filename, 'utf8');\n        local.assetsDict['/assets.npmtest_express_restify_mongoose.rollup.js'] =\n            local.assetsDict['/assets.npmtest_express_restify_mongoose.rollup.js'] ||\n            local.fs.readFileSync(\n                // buildCustomOrg-hack\n                local.npmtest_express_restify_mongoose.__dirname +\n                    '/lib.npmtest_express_restify_mongoose.js',\n                'utf8'\n            ).replace((/^#!/), '//');\n        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';\n        // if $npm_config_timeout_exit exists,\n        // then exit this process after $npm_config_timeout_exit ms\n        if (Number(process.env.npm_config_timeout_exit)) {\n            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\n        }\n        // start server\n        if (local.global.utility2_serverHttp1) {\n            break;\n        }\n        process.env.PORT = process.env.PORT || '8081';\n        console.error('server starting on port ' + process.env.PORT);\n        local.http.createServer(function (request, response) {\n            request.urlParsed = local.url.parse(request.url);\n            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {\n                response.end(local.assetsDict[request.urlParsed.pathname]);\n                return;\n            }\n            response.statusCode = 404;\n            response.end();\n        }).listen(process.env.PORT);\n        break;\n    }\n}());\n","/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/node_modules/express-restify-mongoose/lib/express-restify-mongoose.js":"'use strict';\n\nvar util = require('util');\nvar _ = require('lodash');\nvar Filter = require('./resource_filter');\nvar customDefaults = null;\nvar excludedMap = {};\n\nfunction getDefaults() {\n  return _.defaults(_.clone(customDefaults) || {}, {\n    prefix: '/api',\n    version: '/v1',\n    idProperty: '_id',\n    findOneAndUpdate: true,\n    findOneAndRemove: true,\n    lean: true,\n    restify: false,\n    runValidators: false,\n    allowRegex: true,\n    private: [],\n    protected: []\n  });\n}\n\nvar restify = function restify(app, model) {\n  var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var options = {};\n  _.assign(options, getDefaults(), opts);\n\n  var access = require('./middleware/access');\n  var ensureContentType = require('./middleware/ensureContentType')(options);\n  var filterAndFindById = require('./middleware/filterAndFindById')(model, options);\n  var onError = require('./middleware/onError');\n  var outputFn = require('./middleware/outputFn');\n  var prepareQuery = require('./middleware/prepareQuery')(options);\n  var prepareOutput = require('./middleware/prepareOutput')(options, excludedMap);\n\n  if (!_.isArray(options.private)) {\n    throw new Error('\"options.private\" must be an array of fields');\n  }\n\n  if (!_.isArray(options.protected)) {\n    throw new Error('\"options.protected\" must be an array of fields');\n  }\n\n  model.schema.eachPath(function (name, path) {\n    if (path.options.access) {\n      switch (path.options.access.toLowerCase()) {\n        case 'private':\n          options.private.push(name);\n          break;\n        case 'protected':\n          options.protected.push(name);\n          break;\n      }\n    }\n  });\n\n  options.filter = new Filter({\n    model: model,\n    excludedMap: excludedMap,\n    filteredKeys: {\n      private: options.private,\n      protected: options.protected\n    }\n  });\n\n  excludedMap[model.modelName] = options.filter.filteredKeys;\n\n  if (!_.isArray(options.preMiddleware)) {\n    options.preMiddleware = options.preMiddleware ? [options.preMiddleware] : [];\n  }\n\n  if (!_.isArray(options.preCreate)) {\n    options.preCreate = options.preCreate ? [options.preCreate] : [];\n  }\n\n  if (!_.isArray(options.preRead)) {\n    options.preRead = options.preRead ? [options.preRead] : [];\n  }\n\n  if (!_.isArray(options.preUpdate)) {\n    options.preUpdate = options.preUpdate ? [options.preUpdate] : [];\n  }\n\n  if (!_.isArray(options.preDelete)) {\n    options.preDelete = options.preDelete ? [options.preDelete] : [];\n  }\n\n  if (!options.contextFilter) {\n    options.contextFilter = function (model, req, done) {\n      return done(model);\n    };\n  }\n\n  if (!_.isArray(options.postCreate)) {\n    options.postCreate = options.postCreate ? [options.postCreate] : [];\n  }\n\n  if (!_.isArray(options.postRead)) {\n    options.postRead = options.postRead ? [options.postRead] : [];\n  }\n\n  if (!_.isArray(options.postUpdate)) {\n    options.postUpdate = options.postUpdate ? [options.postUpdate] : [];\n  }\n\n  if (!_.isArray(options.postDelete)) {\n    options.postDelete = options.postDelete ? [options.postDelete] : [];\n  }\n\n  if (!options.onError) {\n    options.onError = onError(!options.restify);\n  }\n\n  if (!options.outputFn) {\n    options.outputFn = outputFn(!options.restify);\n  }\n\n  options.name = options.name || model.modelName;\n\n  var ops = require('./operations')(model, options, excludedMap);\n\n  var uriItem = '' + options.prefix + options.version + '/' + options.name;\n  if (uriItem.indexOf('/:id') === -1) {\n    uriItem += '/:id';\n  }\n\n  var uriItems = uriItem.replace('/:id', '');\n  var uriCount = uriItems + '/count';\n  var uriShallow = uriItem + '/shallow';\n\n  if (_.isUndefined(app.delete)) {\n    app.delete = app.del;\n  }\n\n  app.use(function (req, res, next) {\n    req.erm = { model: model };\n    next();\n  });\n\n  var accessMiddleware = options.access ? access(options) : [];\n\n  app.get(uriItems, prepareQuery, options.preMiddleware, options.preRead, accessMiddleware, ops.getItems, prepareOutput);\n  app.get(uriCount, prepareQuery, options.preMiddleware, options.preRead, accessMiddleware, ops.getCount, prepareOutput);\n  app.get(uriItem, prepareQuery, options.preMiddleware, options.preRead, accessMiddleware, ops.getItem, prepareOutput);\n  app.get(uriShallow, prepareQuery, options.preMiddleware, options.preRead, accessMiddleware, ops.getShallow, prepareOutput);\n\n  app.post(uriItems, prepareQuery, ensureContentType, options.preMiddleware, options.preCreate, accessMiddleware, ops.createObject, prepareOutput);\n  app.post(uriItem, util.deprecate(prepareQuery, 'express-restify-mongoose: in a future major version, the POST method to update resources will be removed. Use PATCH instead.'), ensureContentType, options.preMiddleware, options.findOneAndUpdate ? [] : filterAndFindById, options.preUpdate, accessMiddleware, ops.modifyObject, prepareOutput);\n\n  app.put(uriItem, util.deprecate(prepareQuery, 'express-restify-mongoose: in a future major version, the PUT method will replace rather than update a resource. Use PATCH instead.'), ensureContentType, options.preMiddleware, options.findOneAndUpdate ? [] : filterAndFindById, options.preUpdate, accessMiddleware, ops.modifyObject, prepareOutput);\n  app.patch(uriItem, prepareQuery, ensureContentType, options.preMiddleware, options.findOneAndUpdate ? [] : filterAndFindById, options.preUpdate, accessMiddleware, ops.modifyObject, prepareOutput);\n\n  app.delete(uriItems, prepareQuery, options.preMiddleware, options.preDelete, ops.deleteItems, prepareOutput);\n  app.delete(uriItem, prepareQuery, options.preMiddleware, options.findOneAndRemove ? [] : filterAndFindById, options.preDelete, ops.deleteItem, prepareOutput);\n\n  return uriItems;\n};\n\nmodule.exports = {\n  defaults: function defaults(options) {\n    customDefaults = options;\n  },\n  serve: restify\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9leHByZXNzLXJlc3RpZnktbW9uZ29vc2UuanMiXSwibmFtZXMiOlsidXRpbCIsInJlcXVpcmUiLCJfIiwiRmlsdGVyIiwiY3VzdG9tRGVmYXVsdHMiLCJleGNsdWRlZE1hcCIsImdldERlZmF1bHRzIiwiZGVmYXVsdHMiLCJjbG9uZSIsInByZWZpeCIsInZlcnNpb24iLCJpZFByb3BlcnR5IiwiZmluZE9uZUFuZFVwZGF0ZSIsImZpbmRPbmVBbmRSZW1vdmUiLCJsZWFuIiwicmVzdGlmeSIsInJ1blZhbGlkYXRvcnMiLCJhbGxvd1JlZ2V4IiwicHJpdmF0ZSIsInByb3RlY3RlZCIsImFwcCIsIm1vZGVsIiwib3B0cyIsIm9wdGlvbnMiLCJhc3NpZ24iLCJhY2Nlc3MiLCJlbnN1cmVDb250ZW50VHlwZSIsImZpbHRlckFuZEZpbmRCeUlkIiwib25FcnJvciIsIm91dHB1dEZuIiwicHJlcGFyZVF1ZXJ5IiwicHJlcGFyZU91dHB1dCIsImlzQXJyYXkiLCJFcnJvciIsInNjaGVtYSIsImVhY2hQYXRoIiwibmFtZSIsInBhdGgiLCJ0b0xvd2VyQ2FzZSIsInB1c2giLCJmaWx0ZXIiLCJmaWx0ZXJlZEtleXMiLCJtb2RlbE5hbWUiLCJwcmVNaWRkbGV3YXJlIiwicHJlQ3JlYXRlIiwicHJlUmVhZCIsInByZVVwZGF0ZSIsInByZURlbGV0ZSIsImNvbnRleHRGaWx0ZXIiLCJyZXEiLCJkb25lIiwicG9zdENyZWF0ZSIsInBvc3RSZWFkIiwicG9zdFVwZGF0ZSIsInBvc3REZWxldGUiLCJvcHMiLCJ1cmlJdGVtIiwiaW5kZXhPZiIsInVyaUl0ZW1zIiwicmVwbGFjZSIsInVyaUNvdW50IiwidXJpU2hhbGxvdyIsImlzVW5kZWZpbmVkIiwiZGVsZXRlIiwiZGVsIiwidXNlIiwicmVzIiwibmV4dCIsImVybSIsImFjY2Vzc01pZGRsZXdhcmUiLCJnZXQiLCJnZXRJdGVtcyIsImdldENvdW50IiwiZ2V0SXRlbSIsImdldFNoYWxsb3ciLCJwb3N0IiwiY3JlYXRlT2JqZWN0IiwiZGVwcmVjYXRlIiwibW9kaWZ5T2JqZWN0IiwicHV0IiwicGF0Y2giLCJkZWxldGVJdGVtcyIsImRlbGV0ZUl0ZW0iLCJtb2R1bGUiLCJleHBvcnRzIiwic2VydmUiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsT0FBT0MsUUFBUSxNQUFSLENBQWI7QUFDQSxJQUFNQyxJQUFJRCxRQUFRLFFBQVIsQ0FBVjtBQUNBLElBQU1FLFNBQVNGLFFBQVEsbUJBQVIsQ0FBZjtBQUNBLElBQUlHLGlCQUFpQixJQUFyQjtBQUNBLElBQUlDLGNBQWMsRUFBbEI7O0FBRUEsU0FBU0MsV0FBVCxHQUF3QjtBQUN0QixTQUFPSixFQUFFSyxRQUFGLENBQVdMLEVBQUVNLEtBQUYsQ0FBUUosY0FBUixLQUEyQixFQUF0QyxFQUEwQztBQUMvQ0ssWUFBUSxNQUR1QztBQUUvQ0MsYUFBUyxLQUZzQztBQUcvQ0MsZ0JBQVksS0FIbUM7QUFJL0NDLHNCQUFrQixJQUo2QjtBQUsvQ0Msc0JBQWtCLElBTDZCO0FBTS9DQyxVQUFNLElBTnlDO0FBTy9DQyxhQUFTLEtBUHNDO0FBUS9DQyxtQkFBZSxLQVJnQztBQVMvQ0MsZ0JBQVksSUFUbUM7QUFVL0NDLGFBQVMsRUFWc0M7QUFXL0NDLGVBQVc7QUFYb0MsR0FBMUMsQ0FBUDtBQWFEOztBQUVELElBQU1KLFVBQVUsU0FBVkEsT0FBVSxDQUFVSyxHQUFWLEVBQWVDLEtBQWYsRUFBaUM7QUFBQSxNQUFYQyxJQUFXLHVFQUFKLEVBQUk7O0FBQy9DLE1BQUlDLFVBQVUsRUFBZDtBQUNBckIsSUFBRXNCLE1BQUYsQ0FBU0QsT0FBVCxFQUFrQmpCLGFBQWxCLEVBQWlDZ0IsSUFBakM7O0FBRUEsTUFBTUcsU0FBU3hCLFFBQVEscUJBQVIsQ0FBZjtBQUNBLE1BQU15QixvQkFBb0J6QixRQUFRLGdDQUFSLEVBQTBDc0IsT0FBMUMsQ0FBMUI7QUFDQSxNQUFNSSxvQkFBb0IxQixRQUFRLGdDQUFSLEVBQTBDb0IsS0FBMUMsRUFBaURFLE9BQWpELENBQTFCO0FBQ0EsTUFB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R0FBZ0NlLGlCQUEzRyxFQUE4SEosUUFBUXVCLFNBQXRJLEVBQWlKdUIsZ0JBQWpKLEVBQW1LZCxJQUFJdUIsWUFBdkssRUFBcUwvQyxhQUFyTDs7QUFFQVgsTUFBSTJDLE1BQUosQ0FBV0wsUUFBWCxFQUFxQjVCLFlBQXJCLEVBQW1DUCxRQUFRb0IsYUFBM0MsRUFBMERwQixRQUFRd0IsU0FBbEUsRUFBNkVRLElBQUkwQixXQUFqRixFQUE4RmxELGFBQTlGO0FBQ0FYLE1BQUkyQyxNQUFKLENBQVdQLE9BQVgsRUFBb0IxQixZQUFwQixFQUFrQ1AsUUFBUW9CLGFBQTFDLEVBQXlEcEIsUUFBUVYsZ0JBQVIsR0FBMkIsRUFBM0IsR0FBZ0NjLGlCQUF6RixFQUE0R0osUUFBUXdCLFNBQXBILEVBQStIUSxJQUFJMkIsVUFBbkksRUFBK0luRCxhQUEvSTs7QUFFQSxTQUFPMkIsUUFBUDtBQUNELENBbklEOztBQXFJQXlCLE9BQU9DLE9BQVAsR0FBaUI7QUFDZjdFLFlBQVUsa0JBQVVnQixPQUFWLEVBQW1CO0FBQzNCbkIscUJBQWlCbUIsT0FBakI7QUFDRCxHQUhjO0FBSWY4RCxTQUFPdEU7QUFKUSxDQUFqQiIsImZpbGUiOiJleHByZXNzLXJlc3RpZnktbW9uZ29vc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpXHJcbmNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKVxyXG5jb25zdCBGaWx0ZXIgPSByZXF1aXJlKCcuL3Jlc291cmNlX2ZpbHRlcicpXHJcbmxldCBjdXN0b21EZWZhdWx0cyA9IG51bGxcclxubGV0IGV4Y2x1ZGVkTWFwID0ge31cclxuXHJcbmZ1bmN0aW9uIGdldERlZmF1bHRzICgpIHtcclxuICByZXR1cm4gXy5kZWZhdWx0cyhfLmNsb25lKGN1c3RvbURlZmF1bHRzKSB8fCB7fSwge1xyXG4gICAgcHJlZml4OiAnL2FwaScsXHJcbiAgICB2ZXJzaW9uOiAnL3YxJyxcclxuICAgIGlkUHJvcGVydHk6ICdfaWQnLFxyXG4gICAgZmluZE9uZUFuZFVwZGF0ZTogdHJ1ZSxcclxuICAgIGZpbmRPbmVBbmRSZW1vdmU6IHRydWUsXHJcbiAgICBsZWFuOiB0cnVlLFxyXG4gICAgcmVzdGlmeTogZmFsc2UsXHJcbiAgICBydW5WYWxpZGF0b3JzOiBmYWxzZSxcclxuICAgIGFsbG93UmVnZXg6IHRydWUsXHJcbiAgICBwcml2YXRlOiBbXSxcclxuICAgIHByb3RlY3RlZDogW11cclxuICB9KVxyXG59XHJcblxyXG5jb25zdCByZXN0aWZ5ID0gZnVuY3Rpb24gKGFwcCwgbW9kZWwsIG9wdHMgPSB7fSkge1xyXG4gIGxldCBvcHRpb25zID0ge31cclxuICBfLmFzc2lnbihvcHRpb25zLCBnZXREZWZhdWx0cygpLCBvcHRzKVxyXG5cclxuICBjb25zdCBhY2Nlc3MgPSByZXF1aXJlKCcuL21pZGRsZXdhcmUvYWNjZXNzJylcclxuICBjb25zdCBlbnN1cmVDb250ZW50VHlwZSA9IHJlcXVpcmUoJy4vbWlkZGxld2FyZS9lbnN1cmVDb250ZW50VHlwZScpKG9wdGlvbnMpXHJcbiAgY29uc3QgZmlsdGVyQW5kRmluZEJ5SWQgPSByZXF1aXJlKCcuL21pZGRsZXdhcmUvZmlsdGVyQW5kRmluZEJ5SWQnKShtb2RlbCwgb3B0aW9ucylcclxuICBjb25zdCBvbkVycm9yID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlL29uRXJyb3InKVxyXG4gIGNvbnN0IG91dHB1dEZuID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlL291dHB1dEZuJylcclxuICBjb25zdCBwcmVwYXJlUXVlcnkgPSByZXF1aXJlKCcuL21pZGRsZXdhcmUvcHJlcGFyZVF1ZXJ5Jykob3B0aW9ucylcclxuICBjb25zdCBwcmVwYXJlT3V0cHV0ID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlL3ByZXBhcmVPdXRwdXQnKShvcHRpb25zLCBleGNsdWRlZE1hcClcclxuXHJcbiAgaWYgKCFfLmlzQXJyYXkob3B0aW9ucy5wcml2YXRlKSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdcIm9wdGlvbnMucHJpdmF0ZVwiIG11c3QgYmUgYW4gYXJyYXkgb2YgZmllbGRzJylcclxuICB9XHJcblxyXG4gIGlmICghXy5pc0FycmF5KG9wdGlvbnMucHJvdGVjdGVkKSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdcIm9wdGlvbnMucHJvdGVjdGVkXCIgbXVzdCBiZSBhbiBhcnJheSBvZiBmaWVsZHMnKVxyXG4gIH1cclxuXHJcbiAgbW9kZWwuc2NoZW1hLmVhY2hQYXRoKChuYW1lLCBwYXRoKSA9PiB7XHJcbiAgICBpZiAocGF0aC5vcHRpb25zLmFjY2Vzcykge1xyXG4gICAgICBzd2l0Y2ggKHBhdGgub3B0aW9ucy5hY2Nlc3MudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgIGNhc2UgJ3ByaXZhdGUnOlxyXG4gICAgICAgICAgb3B0aW9ucy5wcml2YXRlLnB1c2gobmFtZSlcclxuICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgY2FzZSAncHJvdGVjdGVkJzpcclxuICAgICAgICAgIG9wdGlvbnMucHJvdGVjdGVkLnB1c2gobmFtZSlcclxuICAgICAgICAgIGJyZWFrXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KVxyXG5cclxuICBvcHRpb25zLmZpbHRlciA9IG5ldyBGaWx0ZXIoe1xyXG4gICAgbW9kZWwsXHJcbiAgICBleGNsdWRlZE1hcCxcclxuICAgIGZpbHRlcmVkS2V5czoge1xyXG4gICAgICBwcml2YXRlOiBvcHRpb25zLnByaXZhdGUsXHJcbiAgICAgIHByb3RlY3RlZDogb3B0aW9ucy5wcm90ZWN0ZWRcclxuICAgIH1cclxuICB9KVxyXG5cclxuICBleGNsdWRlZE1hcFttb2RlbC5tb2RlbE5hbWVdID0gb3B0aW9ucy5maWx0ZXIuZmlsdGVyZWRLZXlzXHJcblxyXG4gIGlmICghXy5pc0FycmF5KG9wdGlvbnMucHJlTWlkZGxld2FyZSkpIHtcclxuICAgIG9wdGlvbnMucHJlTWlkZGxld2FyZSA9IG9wdGlvbnMucHJlTWlkZGxld2FyZSA/IFtvcHRpb25zLnByZU1pZGRsZXdhcmVdIDogW11cclxuICB9XHJcblxyXG4gIGlmICghXy5pc0FycmF5KG9wdGlvbnMucHJlQ3JlYXRlKSkge1xyXG4gICAgb3B0aW9ucy5wcmVDcmVhdGUgPSBvcHRpb25zLnByZUNyZWF0ZSA/IFtvcHRpb25zLnByZUNyZWF0ZV0gOiBbXVxyXG4gIH1cclxuXHJcbiAgaWYgKCFfLmlzQXJyYXkob3B0aW9ucy5wcmVSZWFkKSkge1xyXG4gICAgb3B0aW9ucy5wcmVSZWFkID0gb3B0aW9ucy5wcmVSZWFkID8gW29wdGlvbnMucHJlUmVhZF0gOiBbXVxyXG4gIH1cclxuXHJcbiAgaWYgKCFfLmlzQXJyYXkob3B0aW9ucy5wcmVVcGRhdGUpKSB7XHJcbiAgICBvcHRpb25zLnByZVVwZGF0ZSA9IG9wdGlvbnMucHJlVXBkYXRlID8gW29wdGlvbnMucHJlVXBkYXRlXSA6IFtdXHJcbiAgfVxyXG5cclxuICBpZiAoIV8uaXNBcnJheShvcHRpb25zLnByZURlbGV0ZSkpIHtcclxuICAgIG9wdGlvbnMucHJlRGVsZXRlID0gb3B0aW9ucy5wcmVEZWxldGUgPyBbb3B0aW9ucy5wcmVEZWxldGVdIDogW11cclxuICB9XHJcblxyXG4gIGlmICghb3B0aW9ucy5jb250ZXh0RmlsdGVyKSB7XHJcbiAgICBvcHRpb25zLmNvbnRleHRGaWx0ZXIgPSAobW9kZWwsIHJlcSwgZG9uZSkgPT4gZG9uZShtb2RlbClcclxuICB9XHJcblxyXG4gIGlmICghXy5pc0FycmF5KG9wdGlvbnMucG9zdENyZWF0ZSkpIHtcclxuICAgIG9wdGlvbnMucG9zdENyZWF0ZSA9IG9wdGlvbnMucG9zdENyZWF0ZSA/IFtvcHRpb25zLnBvc3RDcmVhdGVdIDogW11cclxuICB9XHJcblxyXG4gIGlmICghXy5pc0FycmF5KG9wdGlvbnMucG9zdFJlYWQpKSB7XHJcbiAgICBvcHRpb25zLnBvc3RSZWFkID0gb3B0aW9ucy5wb3N0UmVhZCA/IFtvcHRpb25zLnBvc3RSZWFkXSA6IFtdXHJcbiAgfVxyXG5cclxuICBpZiAoIV8uaXNBcnJheShvcHRpb25zLnBvc3RVcGRhdGUpKSB7XHJcbiAgICBvcHRpb25zLnBvc3RVcGRhdGUgPSBvcHRpb25zLnBvc3RVcGRhdGUgPyBbb3B0aW9ucy5wb3N0VXBkYXRlXSA6IFtdXHJcbiAgfVxyXG5cclxuICBpZiAoIV8uaXNBcnJheShvcHRpb25zLnBvc3REZWxldGUpKSB7XHJcbiAgICBvcHRpb25zLnBvc3REZWxldGUgPSBvcHRpb25zLnBvc3REZWxldGUgPyBbb3B0aW9ucy5wb3N0RGVsZXRlXSA6IFtdXHJcbiAgfVxyXG5cclxuICBpZiAoIW9wdGlvbnMub25FcnJvcikge1xyXG4gICAgb3B0aW9ucy5vbkVycm9yID0gb25FcnJvcighb3B0aW9ucy5yZXN0aWZ5KVxyXG4gIH1cclxuXHJcbiAgaWYgKCFvcHRpb25zLm91dHB1dEZuKSB7XHJcbiAgICBvcHRpb25zLm91dHB1dEZuID0gb3V0cHV0Rm4oIW9wdGlvbnMucmVzdGlmeSlcclxuICB9XHJcblxyXG4gIG9wdGlvbnMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBtb2RlbC5tb2RlbE5hbWVcclxuXHJcbiAgY29uc3Qgb3BzID0gcmVxdWlyZSgnLi9vcGVyYXRpb25zJykobW9kZWwsIG9wdGlvbnMsIGV4Y2x1ZGVkTWFwKVxyXG5cclxuICBsZXQgdXJpSXRlbSA9IGAke29wdGlvbnMucHJlZml4fSR7b3B0aW9ucy52ZXJzaW9ufS8ke29wdGlvbnMubmFtZX1gXHJcbiAgaWYgKHVyaUl0ZW0uaW5kZXhPZignLzppZCcpID09PSAtMSkge1xyXG4gICAgdXJpSXRlbSArPSAnLzppZCdcclxuICB9XHJcblxyXG4gIGNvbnN0IHVyaUl0ZW1zID0gdXJpSXRlbS5yZXBsYWNlKCcvOmlkJywgJycpXHJcbiAgY29uc3QgdXJpQ291bnQgPSB1cmlJdGVtcyArICcvY291bnQnXHJcbiAgY29uc3QgdXJpU2hhbGxvdyA9IHVyaUl0ZW0gKyAnL3NoYWxsb3cnXHJcblxyXG4gIGlmIChfLmlzVW5kZWZpbmVkKGFwcC5kZWxldGUpKSB7XHJcbiAgICBhcHAuZGVsZXRlID0gYXBwLmRlbFxyXG4gIH1cclxuXHJcbiAgYXBwLnVzZSgocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHJlcS5lcm0gPSB7IG1vZGVsIH1cclxuICAgIG5leHQoKVxyXG4gIH0pXHJcblxyXG4gIGNvbnN0IGFjY2Vzc01pZGRsZXdhcmUgPSBvcHRpb25zLmFjY2VzcyA/IGFjY2VzcyhvcHRpb25zKSA6IFtdXHJcblxyXG4gIGFwcC5nZXQodXJpSXRlbXMsIHByZXBhcmVRdWVyeSwgb3B0aW9ucy5wcmVNaWRkbGV3YXJlLCBvcHRpb25zLnByZVJlYWQsIGFjY2Vzc01pZGRsZXdhcmUsIG9wcy5nZXRJdGVtcywgcHJlcGFyZU91dHB1dClcclxuICBhcHAuZ2V0KHVyaUNvdW50LCBwcmVwYXJlUXVlcnksIG9wdGlvbnMucHJlTWlkZGxld2FyZSwgb3B0aW9ucy5wcmVSZWFkLCBhY2Nlc3NNaWRkbGV3YXJlLCBvcHMuZ2V0Q291bnQsIHByZXBhcmVPdXRwdXQpXHJcbiAgYXBwLmdldCh1cmlJdGVtLCBwcmVwYXJlUXVlcnksIG9wdGlvbnMucHJlTWlkZGxld2FyZSwgb3B0aW9ucy5wcmVSZWFkLCBhY2Nlc3NNaWRkbGV3YXJlLCBvcHMuZ2V0SXRlbSwgcHJlcGFyZU91dHB1dClcclxuICBhcHAuZ2V0KHVyaVNoYWxsb3csIHByZXBhcmVRdWVyeSwgb3B0aW9ucy5wcmVNaWRkbGV3YXJlLCBvcHRpb25zLnByZVJlYWQsIGFjY2Vzc01pZGRsZXdhcmUsIG9wcy5nZXRTaGFsbG93LCBwcmVwYXJlT3V0cHV0KVxyXG5cclxuICBhcHAucG9zdCh1cmlJdGVtcywgcHJlcGFyZVF1ZXJ5LCBlbnN1cmVDb250ZW50VHlwZSwgb3B0aW9ucy5wcmVNaWRkbGV3YXJlLCBvcHRpb25zLnByZUNyZWF0ZSwgYWNjZXNzTWlkZGxld2FyZSwgb3BzLmNyZWF0ZU9iamVjdCwgcHJlcGFyZU91dHB1dClcclxuICBhcHAucG9zdCh1cmlJdGVtLCB1dGlsLmRlcHJlY2F0ZShwcmVwYXJlUXVlcnksICdleHByZXNzLXJlc3RpZnktbW9uZ29vc2U6IGluIGEgZnV0dXJlIG1ham9yIHZlcnNpb24sIHRoZSBQT1NUIG1ldGhvZCB0byB1cGRhdGUgcmVzb3VyY2VzIHdpbGwgYmUgcmVtb3ZlZC4gVXNlIFBBVENIIGluc3RlYWQuJyksIGVuc3VyZUNvbnRlbnRUeXBlLCBvcHRpb25zLnByZU1pZGRsZXdhcmUsIG9wdGlvbnMuZmluZE9uZUFuZFVwZGF0ZSA/IFtdIDogZmlsdGVyQW5kRmluZEJ5SWQsIG9wdGlvbnMucHJlVXBkYXRlLCBhY2Nlc3NNaWRkbGV3YXJlLCBvcHMubW9kaWZ5T2JqZWN0LCBwcmVwYXJlT3V0cHV0KVxyXG5cclxuICBhcHAucHV0KHVyaUl0ZW0sIHV0aWwuZGVwcmVjYXRlKHByZXBhcmVRdWVyeSwgJ2V4cHJlc3MtcmVzdGlmeS1tb25nb29zZTogaW4gYSBmdXR1cmUgbWFqb3IgdmVyc2lvbiwgdGhlIFBVVCBtZXRob2Qgd2lsbCByZXBsYWNlIHJhdGhlciB0aGFuIHVwZGF0ZSBhIHJlc291cmNlLiBVc2UgUEFUQ0ggaW5zdGVhZC4nKSwgZW5zdXJlQ29udGVudFR5cGUsIG9wdGlvbnMucHJlTWlkZGxld2FyZSwgb3B0aW9ucy5maW5kT25lQW5kVXBkYXRlID8gW10gOiBmaWx0ZXJBbmRGaW5kQnlJZCwgb3B0aW9ucy5wcmVVcGRhdGUsIGFjY2Vzc01pZGRsZXdhcmUsIG9wcy5tb2RpZnlPYmplY3QsIHByZXBhcmVPdXRwdXQpXHJcbiAgYXBwLnBhdGNoKHVyaUl0ZW0sIHByZXBhcmVRdWVyeSwgZW5zdXJlQ29udGVudFR5cGUsIG9wdGlvbnMucHJlTWlkZGxld2FyZSwgb3B0aW9ucy5maW5kT25lQW5kVXBkYXRlID8gW10gOiBmaWx0ZXJBbmRGaW5kQnlJZCwgb3B0aW9ucy5wcmVVcGRhdGUsIGFjY2Vzc01pZGRsZXdhcmUsIG9wcy5tb2RpZnlPYmplY3QsIHByZXBhcmVPdXRwdXQpXHJcblxyXG4gIGFwcC5kZWxldGUodXJpSXRlbXMsIHByZXBhcmVRdWVyeSwgb3B0aW9ucy5wcmVNaWRkbGV3YXJlLCBvcHRpb25zLnByZURlbGV0ZSwgb3BzLmRlbGV0ZUl0ZW1zLCBwcmVwYXJlT3V0cHV0KVxyXG4gIGFwcC5kZWxldGUodXJpSXRlbSwgcHJlcGFyZVF1ZXJ5LCBvcHRpb25zLnByZU1pZGRsZXdhcmUsIG9wdGlvbnMuZmluZE9uZUFuZFJlbW92ZSA/IFtdIDogZmlsdGVyQW5kRmluZEJ5SWQsIG9wdGlvbnMucHJlRGVsZXRlLCBvcHMuZGVsZXRlSXRlbSwgcHJlcGFyZU91dHB1dClcclxuXHJcbiAgcmV0dXJuIHVyaUl0ZW1zXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIGRlZmF1bHRzOiBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgY3VzdG9tRGVmYXVsdHMgPSBvcHRpb25zXHJcbiAgfSxcclxuICBzZXJ2ZTogcmVzdGlmeVxyXG59XHJcbiJdfQ==\n//# sourceMappingURL=express-restify-mongoose.js.map","/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/node_modules/express-restify-mongoose/lib/resource_filter.js":"'use strict';\n\nvar _ = require('lodash');\nvar detective = require('mongoose-detective');\nvar weedout = require('weedout');\n\n/**\r\n * Represents a filter.\r\n * @constructor\r\n * @param {Object} opts - Options\r\n * @param {Object} opts.model - Mongoose model\r\n * @param {Object} opts.excludedMap {} - Filtered keys for related models\r\n * @param {Object} opts.filteredKeys {} - Keys to filter for the current model\r\n */\nfunction Filter(opts) {\n  this.model = opts.model;\n\n  this.filteredKeys = _.isPlainObject(opts.filteredKeys) ? {\n    private: opts.filteredKeys.private || [],\n    protected: opts.filteredKeys.protected || []\n  } : {\n    private: [],\n    protected: []\n  };\n\n  if (this.model && this.model.discriminators && _.isPlainObject(opts.excludedMap)) {\n    for (var modelName in this.model.discriminators) {\n      if (opts.excludedMap[modelName]) {\n        this.filteredKeys.private = this.filteredKeys.private.concat(opts.excludedMap[modelName].private);\n        this.filteredKeys.protected = this.filteredKeys.protected.concat(opts.excludedMap[modelName].protected);\n      }\n    }\n  }\n}\n\n/**\r\n * Gets excluded keys for a given model and access.\r\n * @memberof Filter\r\n * @param {Object} - Options.\r\n * @param {String} opts.access {public} - Access level (private, protected or public).\r\n * @param {Object} opts.excludedMap {} - Filtered keys for related models\r\n * @param {Object} opts.filteredKeys {} - Keys to filter for the current model\r\n * @returns {Array} - Keys to filter.\r\n */\nFilter.prototype.getExcluded = function (opts) {\n  if (opts.access === 'private') {\n    return [];\n  }\n\n  var entry = opts.excludedMap && opts.modelName ? opts.excludedMap[opts.modelName] : null;\n\n  if (!entry) {\n    entry = _.isPlainObject(opts.filteredKeys) ? {\n      private: opts.filteredKeys.private || [],\n      protected: opts.filteredKeys.protected || []\n    } : {\n      private: [],\n      protected: []\n    };\n  }\n\n  return opts.access === 'protected' ? entry.private : entry.private.concat(entry.protected);\n};\n\nFilter.prototype.isExcluded = function (field, opts) {\n  if (!field) {\n    return false;\n  }\n\n  opts = _.defaults(opts, {\n    access: 'public',\n    excludedMap: {},\n    filteredKeys: this.filteredKeys,\n    modelName: this.model.modelName\n  });\n\n  return this.getExcluded(opts).indexOf(field) >= 0;\n};\n\n/**\r\n * Removes excluded keys from a document.\r\n * @memberof Filter\r\n * @param {Object} - Source document.\r\n * @param {Array} - Keys to filter.\r\n * @returns {Object} - Filtered document.\r\n */\nFilter.prototype.filterItem = function (item, excluded) {\n  var _this = this;\n\n  if (_.isArray(item)) {\n    return item.map(function (i) {\n      return _this.filterItem(i, excluded);\n    });\n  }\n\n  if (item && excluded) {\n    if (_.isFunction(item.toObject)) {\n      item = item.toObject();\n    }\n\n    for (var i = 0, length = excluded.length; i < length; i++) {\n      if (excluded[i].indexOf('.') > 0) {\n        weedout(item, excluded[i]);\n      } else {\n        delete item[excluded[i]];\n      }\n    }\n  }\n\n  return item;\n};\n\n/**\r\n * Removes excluded keys from a document with populated subdocuments.\r\n * @memberof Filter\r\n * @param {Object} - Source document.\r\n * @param {Object} - Keys to filter.\r\n * @param {Array} opts.populate - Paths to populated subdocuments.\r\n * @param {String} opts.access - Access level (private, protected or public).\r\n * @param {Object} opts.excludedMap {} - Filtered keys for related models\r\n * @returns {Object} - Filtered document.\r\n */\nFilter.prototype.filterPopulatedItem = function (item, opts) {\n  var _this2 = this;\n\n  if (_.isArray(item)) {\n    return item.map(function (i) {\n      return _this2.filterPopulatedItem(i, opts);\n    });\n  }\n\n  for (var i = 0; i < opts.populate.length; i++) {\n    if (!opts.populate[i].path) {\n      continue;\n    }\n\n    var excluded = this.getExcluded({\n      access: opts.access,\n      excludedMap: opts.excludedMap,\n      modelName: detective(this.model, opts.populate[i].path)\n    });\n\n    if (_.has(item, opts.populate[i].path)) {\n      this.filterItem(_.get(item, opts.populate[i].path), excluded);\n    } else {\n      var pathToArray = opts.populate[i].path.split('.').slice(0, -1).join('.');\n\n      if (_.has(item, pathToArray)) {\n        var array = _.get(item, pathToArray);\n        var pathToObject = opts.populate[i].path.split('.').slice(-1).join('.');\n\n        this.filterItem(_.map(array, pathToObject), excluded);\n      }\n    }\n  }\n\n  return item;\n};\n\n/**\r\n * Removes excluded keys from a document.\r\n * @memberof Filter\r\n * @access public\r\n * @param {Object} - Source document.\r\n * @param {Object} - Options.\r\n * @param {String} opts.access {public} - Access level (private, protected or public).\r\n * @param {Object} opts.excludedMap {} - Filtered keys for related models\r\n * @param {Array} opts.populate - Paths to populated subdocuments.\r\n * @returns {Object} - Filtered document.\r\n */\nFilter.prototype.filterObject = function (resource) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  opts = _.defaults(opts, {\n    access: 'public',\n    excludedMap: {},\n    filteredKeys: this.filteredKeys,\n    modelName: this.model.modelName\n  });\n\n  var filtered = this.filterItem(resource, this.getExcluded(opts));\n\n  if (opts.populate) {\n    this.filterPopulatedItem(filtered, opts);\n  }\n\n  return filtered;\n};\n\nmodule.exports = Filter;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXNvdXJjZV9maWx0ZXIuanMiXSwibmFtZXMiOlsiXyIsInJlcXVpcmUiLCJkZXRlY3RpdmUiLCJ3ZWVkb3V0IiwiRmlsdGVyIiwib3B0cyIsIm1vZGVsIiwiZmlsdGVyZWRLZXlzIiwiaXNQbGFpbk9iamVjdCIsInByaXZhdGUiLCJwcm90ZWN0ZWQiLCJkaXNjcmltaW5hdG9ycyIsImV4Y2x1ZGVkTWFwIiwibW9kZWxOYW1lIiwiY29uY2F0IiwicHJvdG90eXBlIiwiZ2V0RXhjbHVkZWQiLCJhY2Nlc3MiLCJlbnRyeSIsImlzRXhjbHVkZWQiLCJmaWVsZCIsImRlZmF1bHRzIiwiaW5kZXhPZiIsImZpbHRlckl0ZW0iLCJpdGVtIiwiZXhjbHVkZWQiLCJpc0FycmF5IiwibWFwIiwiaSIsImlzRnVuY3Rpb24iLCJ0b09iamVjdCIsImxlbmd0aCIsImZpbHRlclBvcHVsYXRlZEl0ZW0iLCJwb3B1bGF0ZSIsInBhdGgiLCJoYXMiLCJnZXQiLCJwYXRoVG9BcnJheSIsInNwbGl0Iiwic2xpY2UiLCJqb2luIiwiYXJyYXkiLCJwYXRoVG9PYmplY3QiLCJmaWx0ZXJPYmplY3QiLCJyZXNvdXJjZSIsImZpbHRlcmVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxJQUFJQyxRQUFRLFFBQVIsQ0FBVjtBQUNBLElBQU1DLFlBQVlELFFBQVEsb0JBQVIsQ0FBbEI7QUFDQSxJQUFNRSxVQUFVRixRQUFRLFNBQVIsQ0FBaEI7O0FBRUE7Ozs7Ozs7O0FBUUEsU0FBU0csTUFBVCxDQUFpQkMsSUFBakIsRUFBdUI7QUFDckIsT0FBS0MsS0FBTCxHQUFhRCxLQUFLQyxLQUFsQjs7QUFFQSxPQUFLQyxZQUFMLEdBQW9CUCxFQUFFUSxhQUFGLENBQWdCSCxLQUFLRSxZQUFyQixJQUFxQztBQUN2REUsYUFBU0osS0FBS0UsWUFBTCxDQUFrQkUsT0FBbEIsSUFBNkIsRUFEaUI7QUFFdkRDLGVBQVdMLEtBQUtFLFlBQUwsQ0FBa0JHLFNBQWxCLElBQStCO0FBRmEsR0FBckMsR0FHaEI7QUFDRkQsYUFBUyxFQURQO0FBRUZDLGVBQVc7QUFGVCxHQUhKOztBQVFBLE1BQUksS0FBS0osS0FBTCxJQUFjLEtBQUtBLEtBQUwsQ0FBV0ssY0FBekIsSUFBMkNYLEVBQUVRLGFBQUYsQ0FBZ0JILEtBQUtPLFdBQXJCLENBQS9DLEVBQWtGO0FBQ2hGLFNBQUssSUFBSUMsU0FBVCxJQUFzQixLQUFLUCxLQUFMLENBQVdLLGNBQWpDLEVBQWlEO0FBQy9DLFVBQUlOLEtBQUtPLFdBQUwsQ0FBaUJDLFNBQWpCLENBQUosRUFBaUM7QUFDL0IsYUFBS04sWUFBTCxDQUFrQkUsT0FBbEIsR0FBNEIsS0FBS0YsWUFBTCxDQUFrQkUsT0FBbEIsQ0FBMEJLLE1BQTFCLENBQWlDVCxLQUFLTyxXQUFMLENBQWlCQyxTQUFqQixFQUE0QkosT0FBN0QsQ0FBNUI7QUFDQSxhQUFLRixZQUFMLENBQWtCRyxTQUFsQixHQUE4QixLQUFLSCxZQUFMLENBQWtCRyxTQUFsQixDQUE0QkksTUFBNUIsQ0FBbUNULEtBQUtPLFdBQUwsQ0FBaUJDLFNBQWpCLEVBQTRCSCxTQUEvRCxDQUE5QjtBQUNEO0FBQ0Y7QUFDRjtBQUNGOztBQUVEOzs7Ozs7Ozs7QUFTQU4sT0FBT1csU0FBUCxDQUFpQkMsV0FBakIsR0FBK0IsVUFBVVgsSUFBVixFQUFnQjtBQUM3QyxNQUFJQSxLQUFLWSxNQUFMLEtBQWdCLFNBQXBCLEVBQStCO0FBQzdCLFdBQU8sRUFBUDtBQUNEOztBQUVELE1BQUlDLFFBQVFiLEtBQUtPLFdBQUwsSUFBb0JQLEtBQUtRLFNBQXpCLEdBQXFDUixLQUFLTyxXQUFMLENBQWlCUCxLQUFLUSxTQUF0QixDQUFyQyxHQUF3RSxJQUFwRjs7QUFFQSxNQUFJLENBQUNLLEtBQUwsRUFBWTtBQUNWQSxZQUFRbEIsRUFBRVEsYUFBRixDQUFnQkgsS0FBS0UsWUFBckIsSUFBcUM7QUFDM0NFLGVBQVNKLEtBQUtFLFlBQUwsQ0FBa0JFLE9BQWxCLElBQTZCLEVBREs7QUFFM0NDLGlCQUFXTCxLQUFLRSxZQUFMLENBQWtCRyxTQUFsQixJQUErQjtBQUZDLEtBQXJDLEdBR0o7QUFDRkQsZUFBUyxFQURQO0FBRUZDLGlCQUFXO0FBRlQsS0FISjtBQU9EOztBQUVELFNBQU9MLEtBQUtZLE1BQUwsS0FBZ0IsV0FBaEIsR0FBOEJDLE1BQU1ULE9BQXBDLEdBQThDUyxNQUFNVCxPQUFOLENBQWNLLE1BQWQsQ0FBcUJJLE1BQU1SLFNBQTNCLENBQXJEO0FBQ0QsQ0FsQkQ7O0FBb0JBTixPQUFPVyxTQUFQLENBQWlCSSxVQUFqQixHQUE4QixVQUFVQyxLQUFWLEVBQWlCZixJQUFqQixFQUF1QjtBQUNuRCxNQUFJLENBQUNlLEtBQUwsRUFBWTtBQUNWLFdBQU8sS0FBUDtBQUNEOztBQUVEZixTQUFPTCxFQUFFcUIsUUFBRixDQUFXaEIsSUFBWCxFQUFpQjtBQUN0QlksWUFBUSxRQURjO0FBRXRCTCxpQkFBYSxFQUZTO0FBR3RCTCxrQkFBYyxLQUFLQSxZQUhHO0FBSXRCTSxlQUFXLEtBQUtQLEtBQUwsQ0FBV087QUFKQSxHQUFqQixDQUFQOztBQU9BLFNBQU8sS0FBS0csV0FBTCxDQUFpQlgsSUFBakIsRUFBdUJpQixPQUF2QixDQUErQkYsS0FBL0IsS0FBeUMsQ0FBaEQ7QUFDRCxDQWJEOztBQWVBOzs7Ozs7O0FBT0FoQixPQUFPVyxTQUFQLENBQWlCUSxVQUFqQixHQUE4QixVQUFVQyxJQUFWLEVBQWdCQyxRQUFoQixFQUEwQjtBQUFBOztBQUN0RCxNQUFJekIsRUFBRTBCLE9BQUYsQ0FBVUYsSUFBVixDQUFKLEVBQXFCO0FBQ25CLFdBQU9BLEtBQUtHLEdBQUwsQ0FBUyxVQUFDQyxDQUFEO0FBQUEsYUFBTyxNQUFLTCxVQUFMLENBQWdCSyxDQUFoQixFQUFtQkgsUUFBbkIsQ0FBUDtBQUFBLEtBQVQsQ0FBUDtBQUNEOztBQUVELE1BQUlELFFBQVFDLFFBQVosRUFBc0I7QUFDcEIsUUFBSXpCLEVBQUU2QixVQUFGLENBQWFMLEtBQUtNLFFBQWxCLENBQUosRUFBaUM7QUFDL0JOLGFBQU9BLEtBQUtNLFFBQUwsRUFBUDtBQUNEOztBQUVELFNBQUssSUFBSUYsSUFBSSxDQUFSLEVBQVdHLFNBQVNOLFNBQVNNLE1BQWxDLEVBQTBDSCxJQUFJRyxNQUE5QyxFQUFzREgsR0FBdEQsRUFBMkQ7QUFDekQsVUFBSUgsU0FBU0csQ0FBVCxFQUFZTixPQUFaLENBQW9CLEdBQXBCLElBQTJCLENBQS9CLEVBQWtDO0FBQ2hDbkIsZ0JBQVFxQixJQUFSLEVBQWNDLFNBQVNHLENBQVQsQ0FBZDtBQUNELE9BRkQsTUFFTztBQUNMLGVBQU9KLEtBQUtDLFNBQVNHLENBQVQsQ0FBTCxDQUFQO0FBQ0Q7QUFDRjtBQUNGOztBQUVELFNBQU9KLElBQVA7QUFDRCxDQXBCRDs7QUFzQkE7Ozs7Ozs7Ozs7QUFVQXBCLE9BQU9XLFNBQVAsQ0FBaUJpQixtQkFBakIsR0FBdUMsVUFBVVIsSUFBVixFQUFnQm5CLElBQWhCLEVBQXNCO0FBQUE7O0FBQzNELE1BQUlMLEVBQUUwQixPQUFGLENBQVVGLElBQVYsQ0FBSixFQUFxQjtBQUNuQixXQUFPQSxLQUFLRyxHQUFMLENBQVMsVUFBQ0MsQ0FBRDtBQUFBLGFBQU8sT0FBS0ksbUJBQUwsQ0FBeUJKLENBQXpCLEVBQTRCdkIsSUFBNUIsQ0FBUDtBQUFBLEtBQVQsQ0FBUDtBQUNEOztBQUVELE9BQUssSUFBSXVCLElBQUksQ0FBYixFQUFnQkEsSUFBSXZCLEtBQUs0QixRQUFMLENBQWNGLE1BQWxDLEVBQTBDSCxHQUExQyxFQUErQztBQUM3QyxRQUFJLENBQUN2QixLQUFLNEIsUUFBTCxDQUFjTCxDQUFkLEVBQWlCTSxJQUF0QixFQUE0QjtBQUMxQjtBQUNEOztBQUVELFFBQU1ULFdBQVcsS0FBS1QsV0FBTCxDQUFpQjtBQUNoQ0MsY0FBUVosS0FBS1ksTUFEbUI7QUFFaENMLG1CQUFhUCxLQUFLTyxXQUZjO0FBR2hDQyxpQkFBV1gsVUFBVSxLQUFLSSxLQUFmLEVBQXNCRCxLQUFLNEIsUUFBTCxDQUFjTCxDQUFkLEVBQWlCTSxJQUF2QztBQUhxQixLQUFqQixDQUFqQjs7QUFNQSxRQUFJbEMsRUFBRW1DLEdBQUYsQ0FBTVgsSUFBTixFQUFZbkIsS0FBSzRCLFFBQUwsQ0FBY0wsQ0FBZCxFQUFpQk0sSUFBN0IsQ0FBSixFQUF3QztBQUN0QyxXQUFLWCxVQUFMLENBQWdCdkIsRUFBRW9DLEdBQUYsQ0FBTVosSUFBTixFQUFZbkIsS0FBSzRCLFFBQUwsQ0FBY0wsQ0FBZCxFQUFpQk0sSUFBN0IsQ0FBaEIsRUFBb0RULFFBQXBEO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsVUFBTVksY0FBY2hDLEtBQUs0QixRQUFMLENBQWNMLENBQWQsRUFBaUJNLElBQWpCLENBQXNCSSxLQUF0QixDQUE0QixHQUE1QixFQUFpQ0MsS0FBakMsQ0FBdUMsQ0FBdkMsRUFBMEMsQ0FBQyxDQUEzQyxFQUE4Q0MsSUFBOUMsQ0FBbUQsR0FBbkQsQ0FBcEI7O0FBRUEsVUFBSXhDLEVBQUVtQyxHQUFGLENBQU1YLElBQU4sRUFBWWEsV0FBWixDQUFKLEVBQThCO0FBQzVCLFlBQU1JLFFBQVF6QyxFQUFFb0MsR0FBRixDQUFNWixJQUFOLEVBQVlhLFdBQVosQ0FBZDtBQUNBLFlBQU1LLGVBQWVyQyxLQUFLNEIsUUFBTCxDQUFjTCxDQUFkLEVBQWlCTSxJQUFqQixDQUFzQkksS0FBdEIsQ0FBNEIsR0FBNUIsRUFBaUNDLEtBQWpDLENBQXVDLENBQUMsQ0FBeEMsRUFBMkNDLElBQTNDLENBQWdELEdBQWhELENBQXJCOztBQUVBLGFBQUtqQixVQUFMLENBQWdCdkIsRUFBRTJCLEdBQUYsQ0FBTWMsS0FBTixFQUFhQyxZQUFiLENBQWhCLEVBQTRDakIsUUFBNUM7QUFDRDtBQUNGO0FBQ0Y7O0FBRUQsU0FBT0QsSUFBUDtBQUNELENBL0JEOztBQWlDQTs7Ozs7Ozs7Ozs7QUFXQXBCLE9BQU9XLFNBQVAsQ0FBaUI0QixZQUFqQixHQUFnQyxVQUFVQyxRQUFWLEVBQStCO0FBQUEsTUFBWHZDLElBQVcsdUVBQUosRUFBSTs7QUFDN0RBLFNBQU9MLEVBQUVxQixRQUFGLENBQVdoQixJQUFYLEVBQWlCO0FBQ3RCWSxZQUFRLFFBRGM7QUFFdEJMLGlCQUFhLEVBRlM7QUFHdEJMLGtCQUFjLEtBQUtBLFlBSEc7QUFJdEJNLGVBQVcsS0FBS1AsS0FBTCxDQUFXTztBQUpBLEdBQWpCLENBQVA7O0FBT0EsTUFBSWdDLFdBQVcsS0FBS3RCLFVBQUwsQ0FBZ0JxQixRQUFoQixFQUEwQixLQUFLNUIsV0FBTCxDQUFpQlgsSUFBakIsQ0FBMUIsQ0FBZjs7QUFFQSxNQUFJQSxLQUFLNEIsUUFBVCxFQUFtQjtBQUNqQixTQUFLRCxtQkFBTCxDQUF5QmEsUUFBekIsRUFBbUN4QyxJQUFuQztBQUNEOztBQUVELFNBQU93QyxRQUFQO0FBQ0QsQ0FmRDs7QUFpQkFDLE9BQU9DLE9BQVAsR0FBaUIzQyxNQUFqQiIsImZpbGUiOiJyZXNvdXJjZV9maWx0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJylcclxuY29uc3QgZGV0ZWN0aXZlID0gcmVxdWlyZSgnbW9uZ29vc2UtZGV0ZWN0aXZlJylcclxuY29uc3Qgd2VlZG91dCA9IHJlcXVpcmUoJ3dlZWRvdXQnKVxyXG5cclxuLyoqXHJcbiAqIFJlcHJlc2VudHMgYSBmaWx0ZXIuXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIE9wdGlvbnNcclxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMubW9kZWwgLSBNb25nb29zZSBtb2RlbFxyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cy5leGNsdWRlZE1hcCB7fSAtIEZpbHRlcmVkIGtleXMgZm9yIHJlbGF0ZWQgbW9kZWxzXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzLmZpbHRlcmVkS2V5cyB7fSAtIEtleXMgdG8gZmlsdGVyIGZvciB0aGUgY3VycmVudCBtb2RlbFxyXG4gKi9cclxuZnVuY3Rpb24gRmlsdGVyIChvcHRzKSB7XHJcbiAgdGhpcy5tb2RlbCA9IG9wdHMubW9kZWxcclxuXHJcbiAgdGhpcy5maWx0ZXJlZEtleXMgPSBfLmlzUGxhaW5PYmplY3Qob3B0cy5maWx0ZXJlZEtleXMpID8ge1xyXG4gICAgcHJpdmF0ZTogb3B0cy5maWx0ZXJlZEtleXMucHJpdmF0ZSB8fCBbXSxcclxuICAgIHByb3RlY3RlZDogb3B0cy5maWx0ZXJlZEtleXMucHJvdGVjdGVkIHx8IFtdXHJcbiAgfSA6IHtcclxuICAgIHByaXZhdGU6IFtdLFxyXG4gICAgcHJvdGVjdGVkOiBbXVxyXG4gIH1cclxuXHJcbiAgaWYgKHRoaXMubW9kZWwgJiYgdGhpcy5tb2RlbC5kaXNjcmltaW5hdG9ycyAmJiBfLmlzUGxhaW5PYmplY3Qob3B0cy5leGNsdWRlZE1hcCkpIHtcclxuICAgIGZvciAobGV0IG1vZGVsTmFtZSBpbiB0aGlzLm1vZGVsLmRpc2NyaW1pbmF0b3JzKSB7XHJcbiAgICAgIGlmIChvcHRzLmV4Y2x1ZGVkTWFwW21vZGVsTmFtZV0pIHtcclxuICAgICAgICB0aGlzLmZpbHRlcmVkS2V5cy5wcml2YXRlID0gdGhpcy5maWx0ZXJlZEtleXMucHJpdmF0ZS5jb25jYXQob3B0cy5leGNsdWRlZE1hcFttb2RlbE5hbWVdLnByaXZhdGUpXHJcbiAgICAgICAgdGhpcy5maWx0ZXJlZEtleXMucHJvdGVjdGVkID0gdGhpcy5maWx0ZXJlZEtleXMucHJvdGVjdGVkLmNvbmNhdChvcHRzLmV4Y2x1ZGVkTWFwW21vZGVsTmFtZV0ucHJvdGVjdGVkKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2V0cyBleGNsdWRlZCBrZXlzIGZvciBhIGdpdmVuIG1vZGVsIGFuZCBhY2Nlc3MuXHJcbiAqIEBtZW1iZXJvZiBGaWx0ZXJcclxuICogQHBhcmFtIHtPYmplY3R9IC0gT3B0aW9ucy5cclxuICogQHBhcmFtIHtTdHJpbmd9IG9wdHMuYWNjZXNzIHtwdWJsaWN9IC0gQWNjZXNzIGxldmVsIChwcml2YXRlLCBwcm90ZWN0ZWQgb3IgcHVibGljKS5cclxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMuZXhjbHVkZWRNYXAge30gLSBGaWx0ZXJlZCBrZXlzIGZvciByZWxhdGVkIG1vZGVsc1xyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cy5maWx0ZXJlZEtleXMge30gLSBLZXlzIHRvIGZpbHRlciBmb3IgdGhlIGN1cnJlbnQgbW9kZWxcclxuICogQHJldHVybnMge0FycmF5fSAtIEtleXMgdG8gZmlsdGVyLlxyXG4gKi9cclxuRmlsdGVyLnByb3RvdHlwZS5nZXRFeGNsdWRlZCA9IGZ1bmN0aW9uIChvcHRzKSB7XHJcbiAgaWYgKG9wdHMuYWNjZXNzID09PSAncHJpdmF0ZScpIHtcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxuXHJcbiAgbGV0IGVudHJ5ID0gb3B0cy5leGNsdWRlZE1hcCAmJiBvcHRzLm1vZGVsTmFtZSA/IG9wdHMuZXhjbHVkZWRNYXBbb3B0cy5tb2RlbE5hbWVdIDogbnVsbFxyXG5cclxuICBpZiAoIWVudHJ5KSB7XHJcbiAgICBlbnRyeSA9IF8uaXNQbGFpbk9iamVjdChvcHRzLmZpbHRlcmVkS2V5cykgPyB7XHJcbiAgICAgIHByaXZhdGU6IG9wdHMuZmlsdGVyZWRLZXlzLnByaXZhdGUgfHwgW10sXHJcbiAgICAgIHByb3RlY3RlZDogb3B0cy5maWx0ZXJlZEtleXMucHJvdGVjdGVkIHx8IFtdXHJcbiAgICB9IDoge1xyXG4gICAgICBwcml2YXRlOiBbXSxcclxuICAgICAgcHJvdGVjdGVkOiBbXVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG9wdHMuYWNjZXNzID09PSAncHJvdGVjdGVkJyA/IGVudHJ5LnByaXZhdGUgOiBlbnRyeS5wcml2YXRlLmNvbmNhdChlbnRyeS5wcm90ZWN0ZWQpXHJcbn1cclxuXHJcbkZpbHRlci5wcm90b3R5cGUuaXNFeGNsdWRlZCA9IGZ1bmN0aW9uIChmaWVsZCwgb3B0cykge1xyXG4gIGlmICghZmllbGQpIHtcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxuXHJcbiAgb3B0cyA9IF8uZGVmYXVsdHMob3B0cywge1xyXG4gICAgYWNjZXNzOiAncHVibGljJyxcclxuICAgIGV4Y2x1ZGVkTWFwOiB7fSxcclxuICAgIGZpbHRlcmVkS2V5czogdGhpcy5maWx0ZXJlZEtleXMsXHJcbiAgICBtb2RlbE5hbWU6IHRoaXMubW9kZWwubW9kZWxOYW1lXHJcbiAgfSlcclxuXHJcbiAgcmV0dXJuIHRoaXMuZ2V0RXhjbHVkZWQob3B0cykuaW5kZXhPZihmaWVsZCkgPj0gMFxyXG59XHJcblxyXG4vKipcclxuICogUmVtb3ZlcyBleGNsdWRlZCBrZXlzIGZyb20gYSBkb2N1bWVudC5cclxuICogQG1lbWJlcm9mIEZpbHRlclxyXG4gKiBAcGFyYW0ge09iamVjdH0gLSBTb3VyY2UgZG9jdW1lbnQuXHJcbiAqIEBwYXJhbSB7QXJyYXl9IC0gS2V5cyB0byBmaWx0ZXIuXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IC0gRmlsdGVyZWQgZG9jdW1lbnQuXHJcbiAqL1xyXG5GaWx0ZXIucHJvdG90eXBlLmZpbHRlckl0ZW0gPSBmdW5jdGlvbiAoaXRlbSwgZXhjbHVkZWQpIHtcclxuICBpZiAoXy5pc0FycmF5KGl0ZW0pKSB7XHJcbiAgICByZXR1cm4gaXRlbS5tYXAoKGkpID0+IHRoaXMuZmlsdGVySXRlbShpLCBleGNsdWRlZCkpXHJcbiAgfVxyXG5cclxuICBpZiAoaXRlbSAmJiBleGNsdWRlZCkge1xyXG4gICAgaWYgKF8uaXNGdW5jdGlvbihpdGVtLnRvT2JqZWN0KSkge1xyXG4gICAgICBpdGVtID0gaXRlbS50b09iamVjdCgpXHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGV4Y2x1ZGVkLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGlmIChleGNsdWRlZFtpXS5pbmRleE9mKCcuJykgPiAwKSB7XHJcbiAgICAgICAgd2VlZG91dChpdGVtLCBleGNsdWRlZFtpXSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBkZWxldGUgaXRlbVtleGNsdWRlZFtpXV1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGl0ZW1cclxufVxyXG5cclxuLyoqXHJcbiAqIFJlbW92ZXMgZXhjbHVkZWQga2V5cyBmcm9tIGEgZG9jdW1lbnQgd2l0aCBwb3B1bGF0ZWQgc3ViZG9jdW1lbnRzLlxyXG4gKiBAbWVtYmVyb2YgRmlsdGVyXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSAtIFNvdXJjZSBkb2N1bWVudC5cclxuICogQHBhcmFtIHtPYmplY3R9IC0gS2V5cyB0byBmaWx0ZXIuXHJcbiAqIEBwYXJhbSB7QXJyYXl9IG9wdHMucG9wdWxhdGUgLSBQYXRocyB0byBwb3B1bGF0ZWQgc3ViZG9jdW1lbnRzLlxyXG4gKiBAcGFyYW0ge1N0cmluZ30gb3B0cy5hY2Nlc3MgLSBBY2Nlc3MgbGV2ZWwgKHByaXZhdGUsIHByb3RlY3RlZCBvciBwdWJsaWMpLlxyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cy5leGNsdWRlZE1hcCB7fSAtIEZpbHRlcmVkIGtleXMgZm9yIHJlbGF0ZWQgbW9kZWxzXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IC0gRmlsdGVyZWQgZG9jdW1lbnQuXHJcbiAqL1xyXG5GaWx0ZXIucHJvdG90eXBlLmZpbHRlclBvcHVsYXRlZEl0ZW0gPSBmdW5jdGlvbiAoaXRlbSwgb3B0cykge1xyXG4gIGlmIChfLmlzQXJyYXkoaXRlbSkpIHtcclxuICAgIHJldHVybiBpdGVtLm1hcCgoaSkgPT4gdGhpcy5maWx0ZXJQb3B1bGF0ZWRJdGVtKGksIG9wdHMpKVxyXG4gIH1cclxuXHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRzLnBvcHVsYXRlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBpZiAoIW9wdHMucG9wdWxhdGVbaV0ucGF0aCkge1xyXG4gICAgICBjb250aW51ZVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGV4Y2x1ZGVkID0gdGhpcy5nZXRFeGNsdWRlZCh7XHJcbiAgICAgIGFjY2Vzczogb3B0cy5hY2Nlc3MsXHJcbiAgICAgIGV4Y2x1ZGVkTWFwOiBvcHRzLmV4Y2x1ZGVkTWFwLFxyXG4gICAgICBtb2RlbE5hbWU6IGRldGVjdGl2ZSh0aGlzLm1vZGVsLCBvcHRzLnBvcHVsYXRlW2ldLnBhdGgpXHJcbiAgICB9KVxyXG5cclxuICAgIGlmIChfLmhhcyhpdGVtLCBvcHRzLnBvcHVsYXRlW2ldLnBhdGgpKSB7XHJcbiAgICAgIHRoaXMuZmlsdGVySXRlbShfLmdldChpdGVtLCBvcHRzLnBvcHVsYXRlW2ldLnBhdGgpLCBleGNsdWRlZClcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHBhdGhUb0FycmF5ID0gb3B0cy5wb3B1bGF0ZVtpXS5wYXRoLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmpvaW4oJy4nKVxyXG5cclxuICAgICAgaWYgKF8uaGFzKGl0ZW0sIHBhdGhUb0FycmF5KSkge1xyXG4gICAgICAgIGNvbnN0IGFycmF5ID0gXy5nZXQoaXRlbSwgcGF0aFRvQXJyYXkpXHJcbiAgICAgICAgY29uc3QgcGF0aFRvT2JqZWN0ID0gb3B0cy5wb3B1bGF0ZVtpXS5wYXRoLnNwbGl0KCcuJykuc2xpY2UoLTEpLmpvaW4oJy4nKVxyXG5cclxuICAgICAgICB0aGlzLmZpbHRlckl0ZW0oXy5tYXAoYXJyYXksIHBhdGhUb09iamVjdCksIGV4Y2x1ZGVkKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gaXRlbVxyXG59XHJcblxyXG4vKipcclxuICogUmVtb3ZlcyBleGNsdWRlZCBrZXlzIGZyb20gYSBkb2N1bWVudC5cclxuICogQG1lbWJlcm9mIEZpbHRlclxyXG4gKiBAYWNjZXNzIHB1YmxpY1xyXG4gKiBAcGFyYW0ge09iamVjdH0gLSBTb3VyY2UgZG9jdW1lbnQuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSAtIE9wdGlvbnMuXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBvcHRzLmFjY2VzcyB7cHVibGljfSAtIEFjY2VzcyBsZXZlbCAocHJpdmF0ZSwgcHJvdGVjdGVkIG9yIHB1YmxpYykuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzLmV4Y2x1ZGVkTWFwIHt9IC0gRmlsdGVyZWQga2V5cyBmb3IgcmVsYXRlZCBtb2RlbHNcclxuICogQHBhcmFtIHtBcnJheX0gb3B0cy5wb3B1bGF0ZSAtIFBhdGhzIHRvIHBvcHVsYXRlZCBzdWJkb2N1bWVudHMuXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IC0gRmlsdGVyZWQgZG9jdW1lbnQuXHJcbiAqL1xyXG5GaWx0ZXIucHJvdG90eXBlLmZpbHRlck9iamVjdCA9IGZ1bmN0aW9uIChyZXNvdXJjZSwgb3B0cyA9IHt9KSB7XHJcbiAgb3B0cyA9IF8uZGVmYXVsdHMob3B0cywge1xyXG4gICAgYWNjZXNzOiAncHVibGljJyxcclxuICAgIGV4Y2x1ZGVkTWFwOiB7fSxcclxuICAgIGZpbHRlcmVkS2V5czogdGhpcy5maWx0ZXJlZEtleXMsXHJcbiAgICBtb2RlbE5hbWU6IHRoaXMubW9kZWwubW9kZWxOYW1lXHJcbiAgfSlcclxuXHJcbiAgbGV0IGZpbHRlcmVkID0gdGhpcy5maWx0ZXJJdGVtKHJlc291cmNlLCB0aGlzLmdldEV4Y2x1ZGVkKG9wdHMpKVxyXG5cclxuICBpZiAob3B0cy5wb3B1bGF0ZSkge1xyXG4gICAgdGhpcy5maWx0ZXJQb3B1bGF0ZWRJdGVtKGZpbHRlcmVkLCBvcHRzKVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGZpbHRlcmVkXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRmlsdGVyXHJcbiJdfQ==\n//# sourceMappingURL=resource_filter.js.map","/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/node_modules/express-restify-mongoose/lib/buildQuery.js":"'use strict';\n\nvar Promise = require('bluebird');\n\nmodule.exports = function (options) {\n  return function (query, queryOptions) {\n    var promise = new Promise(function (resolve, reject) {\n      if (!queryOptions) {\n        return resolve(query);\n      }\n\n      if (queryOptions.query) {\n        query.where(queryOptions.query);\n      }\n\n      if (queryOptions.skip) {\n        query.skip(queryOptions.skip);\n      }\n\n      if (options.limit && (!queryOptions.limit || queryOptions.limit === '0' || queryOptions.limit > options.limit)) {\n        queryOptions.limit = options.limit;\n      }\n\n      if (queryOptions.limit && query.op !== 'count' && !queryOptions.distinct) {\n        query.limit(queryOptions.limit);\n      }\n\n      if (queryOptions.sort) {\n        query.sort(queryOptions.sort);\n      }\n\n      if (queryOptions.populate) {\n        query.populate(queryOptions.populate);\n      }\n\n      if (queryOptions.select) {\n        query.select(queryOptions.select);\n      }\n\n      if (queryOptions.distinct) {\n        query.distinct(queryOptions.distinct);\n      }\n\n      if (options.readPreference) {\n        query.read(options.readPreference);\n      }\n\n      if (options.lean) {\n        query.lean(options.lean);\n      }\n\n      resolve(query);\n    });\n\n    return promise;\n  };\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9idWlsZFF1ZXJ5LmpzIl0sIm5hbWVzIjpbIlByb21pc2UiLCJyZXF1aXJlIiwibW9kdWxlIiwiZXhwb3J0cyIsIm9wdGlvbnMiLCJxdWVyeSIsInF1ZXJ5T3B0aW9ucyIsInByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwid2hlcmUiLCJza2lwIiwibGltaXQiLCJvcCIsImRpc3RpbmN0Iiwic29ydCIsInBvcHVsYXRlIiwic2VsZWN0IiwicmVhZFByZWZlcmVuY2UiLCJyZWFkIiwibGVhbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxVQUFVQyxRQUFRLFVBQVIsQ0FBaEI7O0FBRUFDLE9BQU9DLE9BQVAsR0FBaUIsVUFBVUMsT0FBVixFQUFtQjtBQUNsQyxTQUFPLFVBQVVDLEtBQVYsRUFBaUJDLFlBQWpCLEVBQStCO0FBQ3BDLFFBQU1DLFVBQVUsSUFBSVAsT0FBSixDQUFZLFVBQUNRLE9BQUQsRUFBVUMsTUFBVixFQUFxQjtBQUMvQyxVQUFJLENBQUNILFlBQUwsRUFBbUI7QUFDakIsZUFBT0UsUUFBUUgsS0FBUixDQUFQO0FBQ0Q7O0FBRUQsVUFBSUMsYUFBYUQsS0FBakIsRUFBd0I7QUFDdEJBLGNBQU1LLEtBQU4sQ0FBWUosYUFBYUQsS0FBekI7QUFDRDs7QUFFRCxVQUFJQyxhQUFhSyxJQUFqQixFQUF1QjtBQUNyQk4sY0FBTU0sSUFBTixDQUFXTCxhQUFhSyxJQUF4QjtBQUNEOztBQUVELFVBQUlQLFFBQVFRLEtBQVIsS0FBa0IsQ0FBQ04sYUFBYU0sS0FBZCxJQUF1Qk4sYUFBYU0sS0FBYixLQUF1QixHQUE5QyxJQUFxRE4sYUFBYU0sS0FBYixHQUFxQlIsUUFBUVEsS0FBcEcsQ0FBSixFQUFnSDtBQUM5R04scUJBQWFNLEtBQWIsR0FBcUJSLFFBQVFRLEtBQTdCO0FBQ0Q7O0FBRUQsVUFBSU4sYUFBYU0sS0FBYixJQUFzQlAsTUFBTVEsRUFBTixLQUFhLE9BQW5DLElBQThDLENBQUNQLGFBQWFRLFFBQWhFLEVBQTBFO0FBQ3hFVCxjQUFNTyxLQUFOLENBQVlOLGFBQWFNLEtBQXpCO0FBQ0Q7O0FBRUQsVUFBSU4sYUFBYVMsSUFBakIsRUFBdUI7QUFDckJWLGNBQU1VLElBQU4sQ0FBV1QsYUFBYVMsSUFBeEI7QUFDRDs7QUFFRCxVQUFJVCxhQUFhVSxRQUFqQixFQUEyQjtBQUN6QlgsY0FBTVcsUUFBTixDQUFlVixhQUFhVSxRQUE1QjtBQUNEOztBQUVELFVBQUlWLGFBQWFXLE1BQWpCLEVBQXlCO0FBQ3ZCWixjQUFNWSxNQUFOLENBQWFYLGFBQWFXLE1BQTFCO0FBQ0Q7O0FBRUQsVUFBSVgsYUFBYVEsUUFBakIsRUFBMkI7QUFDekJULGNBQU1TLFFBQU4sQ0FBZVIsYUFBYVEsUUFBNUI7QUFDRDs7QUFFRCxVQUFJVixRQUFRYyxjQUFaLEVBQTRCO0FBQzFCYixjQUFNYyxJQUFOLENBQVdmLFFBQVFjLGNBQW5CO0FBQ0Q7O0FBRUQsVUFBSWQsUUFBUWdCLElBQVosRUFBa0I7QUFDaEJmLGNBQU1lLElBQU4sQ0FBV2hCLFFBQVFnQixJQUFuQjtBQUNEOztBQUVEWixjQUFRSCxLQUFSO0FBQ0QsS0E5Q2UsQ0FBaEI7O0FBZ0RBLFdBQU9FLE9BQVA7QUFDRCxHQWxERDtBQW1ERCxDQXBERCIsImZpbGUiOiJidWlsZFF1ZXJ5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUHJvbWlzZSA9IHJlcXVpcmUoJ2JsdWViaXJkJylcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICByZXR1cm4gZnVuY3Rpb24gKHF1ZXJ5LCBxdWVyeU9wdGlvbnMpIHtcclxuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGlmICghcXVlcnlPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUocXVlcnkpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMucXVlcnkpIHtcclxuICAgICAgICBxdWVyeS53aGVyZShxdWVyeU9wdGlvbnMucXVlcnkpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMuc2tpcCkge1xyXG4gICAgICAgIHF1ZXJ5LnNraXAocXVlcnlPcHRpb25zLnNraXApXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvcHRpb25zLmxpbWl0ICYmICghcXVlcnlPcHRpb25zLmxpbWl0IHx8IHF1ZXJ5T3B0aW9ucy5saW1pdCA9PT0gJzAnIHx8IHF1ZXJ5T3B0aW9ucy5saW1pdCA+IG9wdGlvbnMubGltaXQpKSB7XHJcbiAgICAgICAgcXVlcnlPcHRpb25zLmxpbWl0ID0gb3B0aW9ucy5saW1pdFxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocXVlcnlPcHRpb25zLmxpbWl0ICYmIHF1ZXJ5Lm9wICE9PSAnY291bnQnICYmICFxdWVyeU9wdGlvbnMuZGlzdGluY3QpIHtcclxuICAgICAgICBxdWVyeS5saW1pdChxdWVyeU9wdGlvbnMubGltaXQpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMuc29ydCkge1xyXG4gICAgICAgIHF1ZXJ5LnNvcnQocXVlcnlPcHRpb25zLnNvcnQpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMucG9wdWxhdGUpIHtcclxuICAgICAgICBxdWVyeS5wb3B1bGF0ZShxdWVyeU9wdGlvbnMucG9wdWxhdGUpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMuc2VsZWN0KSB7XHJcbiAgICAgICAgcXVlcnkuc2VsZWN0KHF1ZXJ5T3B0aW9ucy5zZWxlY3QpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMuZGlzdGluY3QpIHtcclxuICAgICAgICBxdWVyeS5kaXN0aW5jdChxdWVyeU9wdGlvbnMuZGlzdGluY3QpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvcHRpb25zLnJlYWRQcmVmZXJlbmNlKSB7XHJcbiAgICAgICAgcXVlcnkucmVhZChvcHRpb25zLnJlYWRQcmVmZXJlbmNlKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAob3B0aW9ucy5sZWFuKSB7XHJcbiAgICAgICAgcXVlcnkubGVhbihvcHRpb25zLmxlYW4pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc29sdmUocXVlcnkpXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiBwcm9taXNlXHJcbiAgfVxyXG59XHJcbiJdfQ==\n//# sourceMappingURL=buildQuery.js.map","/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/node_modules/express-restify-mongoose/lib/errorHandler.js":"'use strict';\n\nvar http = require('http');\n\nmodule.exports = function (options) {\n  return function (req, res, next) {\n    return function (err) {\n      if (err.message === http.STATUS_CODES[404] || req.params.id && err.path === options.idProperty && err.name === 'CastError') {\n        req.erm.statusCode = 404;\n      } else {\n        req.erm.statusCode = req.erm.statusCode && req.erm.statusCode >= 400 ? req.erm.statusCode : 400;\n      }\n\n      options.onError(err, req, res, next);\n    };\n  };\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lcnJvckhhbmRsZXIuanMiXSwibmFtZXMiOlsiaHR0cCIsInJlcXVpcmUiLCJtb2R1bGUiLCJleHBvcnRzIiwib3B0aW9ucyIsInJlcSIsInJlcyIsIm5leHQiLCJlcnIiLCJtZXNzYWdlIiwiU1RBVFVTX0NPREVTIiwicGFyYW1zIiwiaWQiLCJwYXRoIiwiaWRQcm9wZXJ0eSIsIm5hbWUiLCJlcm0iLCJzdGF0dXNDb2RlIiwib25FcnJvciJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxPQUFPQyxRQUFRLE1BQVIsQ0FBYjs7QUFFQUMsT0FBT0MsT0FBUCxHQUFpQixVQUFVQyxPQUFWLEVBQW1CO0FBQ2xDLFNBQU8sVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CQyxJQUFwQixFQUEwQjtBQUMvQixXQUFPLFVBQVVDLEdBQVYsRUFBZTtBQUNwQixVQUFJQSxJQUFJQyxPQUFKLEtBQWdCVCxLQUFLVSxZQUFMLENBQWtCLEdBQWxCLENBQWhCLElBQTJDTCxJQUFJTSxNQUFKLENBQVdDLEVBQVgsSUFBaUJKLElBQUlLLElBQUosS0FBYVQsUUFBUVUsVUFBdEMsSUFBb0ROLElBQUlPLElBQUosS0FBYSxXQUFoSCxFQUE4SDtBQUM1SFYsWUFBSVcsR0FBSixDQUFRQyxVQUFSLEdBQXFCLEdBQXJCO0FBQ0QsT0FGRCxNQUVPO0FBQ0xaLFlBQUlXLEdBQUosQ0FBUUMsVUFBUixHQUFxQlosSUFBSVcsR0FBSixDQUFRQyxVQUFSLElBQXNCWixJQUFJVyxHQUFKLENBQVFDLFVBQVIsSUFBc0IsR0FBNUMsR0FBa0RaLElBQUlXLEdBQUosQ0FBUUMsVUFBMUQsR0FBdUUsR0FBNUY7QUFDRDs7QUFFRGIsY0FBUWMsT0FBUixDQUFnQlYsR0FBaEIsRUFBcUJILEdBQXJCLEVBQTBCQyxHQUExQixFQUErQkMsSUFBL0I7QUFDRCxLQVJEO0FBU0QsR0FWRDtBQVdELENBWkQiLCJmaWxlIjoiZXJyb3JIYW5kbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gIHJldHVybiBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgIGlmIChlcnIubWVzc2FnZSA9PT0gaHR0cC5TVEFUVVNfQ09ERVNbNDA0XSB8fCAocmVxLnBhcmFtcy5pZCAmJiBlcnIucGF0aCA9PT0gb3B0aW9ucy5pZFByb3BlcnR5ICYmIGVyci5uYW1lID09PSAnQ2FzdEVycm9yJykpIHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSA0MDRcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSByZXEuZXJtLnN0YXR1c0NvZGUgJiYgcmVxLmVybS5zdGF0dXNDb2RlID49IDQwMCA/IHJlcS5lcm0uc3RhdHVzQ29kZSA6IDQwMFxyXG4gICAgICB9XHJcblxyXG4gICAgICBvcHRpb25zLm9uRXJyb3IoZXJyLCByZXEsIHJlcywgbmV4dClcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19\n//# sourceMappingURL=errorHandler.js.map","/home/travis/build/npmtest/node-npmtest-express-restify-mongoose/node_modules/express-restify-mongoose/lib/operations.js":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar _ = require('lodash');\nvar http = require('http');\nvar moredots = require('moredots');\n\nmodule.exports = function (model, options, excludedMap) {\n  var buildQuery = require('./buildQuery')(options);\n  var errorHandler = require('./errorHandler')(options);\n\n  function findById(filteredContext, id) {\n    return filteredContext.findOne().and(_defineProperty({}, options.idProperty, id));\n  }\n\n  function isDistinctExcluded(req) {\n    return options.filter.isExcluded(req._ermQueryOptions['distinct'], {\n      access: req.access,\n      excludedMap: excludedMap\n    });\n  }\n\n  function getItems(req, res, next) {\n    if (isDistinctExcluded(req)) {\n      req.erm.result = [];\n      req.erm.statusCode = 200;\n      return next();\n    }\n\n    options.contextFilter(model, req, function (filteredContext) {\n      buildQuery(filteredContext.find(), req._ermQueryOptions).then(function (items) {\n        req.erm.result = items;\n        req.erm.statusCode = 200;\n\n        if (options.totalCountHeader && !req._ermQueryOptions['distinct']) {\n          options.contextFilter(model, req, function (countFilteredContext) {\n            buildQuery(countFilteredContext.count(), _.assign(req._ermQueryOptions, {\n              skip: 0,\n              limit: 0\n            })).then(function (count) {\n              req.erm.totalCount = count;\n              next();\n            }, errorHandler(req, res, next));\n          });\n        } else {\n          next();\n        }\n      }, errorHandler(req, res, next));\n    });\n  }\n\n  function getCount(req, res, next) {\n    options.contextFilter(model, req, function (filteredContext) {\n      buildQuery(filteredContext.count(), req._ermQueryOptions).then(function (count) {\n        req.erm.result = { count: count };\n        req.erm.statusCode = 200;\n\n        next();\n      }, errorHandler(req, res, next));\n    });\n  }\n\n  function getShallow(req, res, next) {\n    options.contextFilter(model, req, function (filteredContext) {\n      buildQuery(findById(filteredContext, req.params.id), req._ermQueryOptions).then(function (item) {\n        if (!item) {\n          return errorHandler(req, res, next)(new Error(http.STATUS_CODES[404]));\n        }\n\n        for (var prop in item) {\n          item[prop] = _typeof(item[prop]) === 'object' && prop !== '_id' ? true : item[prop];\n        }\n\n        req.erm.result = item;\n        req.erm.statusCode = 200;\n\n        next();\n      }, errorHandler(req, res, next));\n    });\n  }\n\n  function deleteItems(req, res, next) {\n    options.contextFilter(model, req, function (filteredContext) {\n      buildQuery(filteredContext.remove(), req._ermQueryOptions).then(function () {\n        req.erm.statusCode = 204;\n\n        next();\n      }, errorHandler(req, res, next));\n    });\n  }\n\n  function getItem(req, res, next) {\n    if (isDistinctExcluded(req)) {\n      req.erm.result = [];\n      req.erm.statusCode = 200;\n      return next();\n    }\n\n    options.contextFilter(model, req, function (filteredContext) {\n      buildQuery(findById(filteredContext, req.params.id), req._ermQueryOptions).then(function (item) {\n        if (!item) {\n          return errorHandler(req, res, next)(new Error(http.STATUS_CODES[404]));\n        }\n\n        req.erm.result = item;\n        req.erm.statusCode = 200;\n\n        next();\n      }, errorHandler(req, res, next));\n    });\n  }\n\n  function deleteItem(req, res, next) {\n    if (options.findOneAndRemove) {\n      options.contextFilter(model, req, function (filteredContext) {\n        findById(filteredContext, req.params.id).findOneAndRemove().then(function (item) {\n          if (!item) {\n            return errorHandler(req, res, next)(new Error(http.STATUS_CODES[404]));\n          }\n\n          req.erm.statusCode = 204;\n\n          next();\n        }, errorHandler(req, res, next));\n      });\n    } else {\n      req.erm.document.remove().then(function () {\n        req.erm.statusCode = 204;\n\n        next();\n      }, errorHandler(req, res, next));\n    }\n  }\n\n  function createObject(req, res, next) {\n    req.body = options.filter.filterObject(req.body || {}, {\n      access: req.access,\n      populate: req._ermQueryOptions.populate\n    });\n\n    if (model.schema.options._id) {\n      delete req.body._id;\n    }\n\n    if (model.schema.options.versionKey) {\n      delete req.body[model.schema.options.versionKey];\n    }\n\n    model.create(req.body).then(function (item) {\n      return model.populate(item, req._ermQueryOptions.populate || []);\n    }).then(function (item) {\n      req.erm.result = item;\n      req.erm.statusCode = 201;\n\n      next();\n    }, errorHandler(req, res, next));\n  }\n\n  function modifyObject(req, res, next) {\n    req.body = options.filter.filterObject(req.body || {}, {\n      access: req.access,\n      populate: req._ermQueryOptions.populate\n    });\n\n    delete req.body._id;\n\n    if (model.schema.options.versionKey) {\n      delete req.body[model.schema.options.versionKey];\n    }\n\n    function depopulate(src) {\n      var dst = {};\n\n      for (var key in src) {\n        var path = model.schema.path(key);\n\n        if (path && path.caster && path.caster.instance === 'ObjectID') {\n          if (_.isArray(src[key])) {\n            for (var j = 0; j < src[key].length; ++j) {\n              if (_typeof(src[key][j]) === 'object') {\n                dst[key] = dst[key] || {};\n                dst[key][j] = src[key][j]._id;\n              }\n            }\n          } else if (_.isPlainObject(src[key])) {\n            dst[key] = src[key]._id;\n          }\n        } else if (_.isPlainObject(src[key])) {\n          if (path && path.instance === 'ObjectID') {\n            dst[key] = src[key]._id;\n          } else {\n            dst[key] = depopulate(src[key]);\n          }\n        }\n\n        if (_.isUndefined(dst[key])) {\n          dst[key] = src[key];\n        }\n      }\n\n      return dst;\n    }\n\n    var cleanBody = moredots(depopulate(req.body));\n\n    if (options.findOneAndUpdate) {\n      options.contextFilter(model, req, function (filteredContext) {\n        findById(filteredContext, req.params.id).findOneAndUpdate({}, {\n          $set: cleanBody\n        }, {\n          new: true,\n          runValidators: options.runValidators\n        }).exec().then(function (item) {\n          return model.populate(item, req._ermQueryOptions.populate || []);\n        }).then(function (item) {\n          if (!item) {\n            return errorHandler(req, res, next)(new Error(http.STATUS_CODES[404]));\n          }\n\n          req.erm.result = item;\n          req.erm.statusCode = 200;\n\n          next();\n        }, errorHandler(req, res, next));\n      });\n    } else {\n      for (var key in cleanBody) {\n        req.erm.document.set(key, cleanBody[key]);\n      }\n\n      req.erm.document.save().then(function (item) {\n        return model.populate(item, req._ermQueryOptions.populate || []);\n      }).then(function (item) {\n        req.erm.result = item;\n        req.erm.statusCode = 200;\n\n        next();\n      }, errorHandler(req, res, next));\n    }\n  }\n\n  return { getItems: getItems, getCount: getCount, getItem: getItem, getShallow: getShallow, createObject: createObject, modifyObject: modifyObject, deleteItems: deleteItems, deleteItem: deleteItem };\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vcGVyYXRpb25zLmpzIl0sIm5hbWVzIjpbIl8iLCJyZXF1aXJlIiwiaHR0cCIsIm1vcmVkb3RzIiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIiwib3B0aW9ucyIsImV4Y2x1ZGVkTWFwIiwiYnVpbGRRdWVyeSIsImVycm9ySGFuZGxlciIsImZpbmRCeUlkIiwiZmlsdGVyZWRDb250ZXh0IiwiaWQiLCJmaW5kT25lIiwiYW5kIiwiaWRQcm9wZXJ0eSIsImlzRGlzdGluY3RFeGNsdWRlZCIsInJlcSIsImZpbHRlciIsImlzRXhjbHVkZWQiLCJfZXJtUXVlcnlPcHRpb25zIiwiYWNjZXNzIiwiZ2V0SXRlbXMiLCJyZXMiLCJuZXh0IiwiZXJtIiwicmVzdWx0Iiwic3RhdHVzQ29kZSIsImNvbnRleHRGaWx0ZXIiLCJmaW5kIiwidGhlbiIsIml0ZW1zIiwidG90YWxDb3VudEhlYWRlciIsImNvdW50RmlsdGVyZWRDb250ZXh0IiwiY291bnQiLCJhc3NpZ24iLCJza2lwIiwibGltaXQiLCJ0b3RhbENvdW50IiwiZ2V0Q291bnQiLCJnZXRTaGFsbG93IiwicGFyYW1zIiwiaXRlbSIsIkVycm9yIiwiU1RBVFVTX0NPREVTIiwicHJvcCIsImRlbGV0ZUl0ZW1zIiwicmVtb3ZlIiwiZ2V0SXRlbSIsImRlbGV0ZUl0ZW0iLCJmaW5kT25lQW5kUmVtb3ZlIiwiZG9jdW1lbnQiLCJjcmVhdGVPYmplY3QiLCJib2R5IiwiZmlsdGVyT2JqZWN0IiwicG9wdWxhdGUiLCJzY2hlbWEiLCJfaWQiLCJ2ZXJzaW9uS2V5IiwiY3JlYXRlIiwibW9kaWZ5T2JqZWN0IiwiZGVwb3B1bGF0ZSIsInNyYyIsImRzdCIsImtleSIsInBhdGgiLCJjYXN0ZXIiLCJpbnN0YW5jZSIsImlzQXJyYXkiLCJqIiwibGVuZ3RoIiwiaXNQbGFpbk9iamVjdCIsImlzVW5kZWZpbmVkIiwiY2xlYW5Cb2R5IiwiZmluZE9uZUFuZFVwZGF0ZSIsIiRzZXQiLCJuZXciLCJydW5WYWxpZGF0b3Jz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QixrQkFBWixFQUFzQlMsZ0JBQXRCLEVBQStCUixzQkFBL0IsRUFBMkNZLDBCQUEzQyxFQUF5RFEsMEJBQXpELEVBQXVFZCx3QkFBdkUsRUFBb0ZHLHNCQUFwRixFQUFQO0FBQ0QsQ0F2T0QiLCJmaWxlIjoib3BlcmF0aW9ucy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKVxyXG5jb25zdCBodHRwID0gcmVxdWlyZSgnaHR0cCcpXHJcbmNvbnN0IG1vcmVkb3RzID0gcmVxdWlyZSgnbW9yZWRvdHMnKVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobW9kZWwsIG9wdGlvbnMsIGV4Y2x1ZGVkTWFwKSB7XHJcbiAgY29uc3QgYnVpbGRRdWVyeSA9IHJlcXVpcmUoJy4vYnVpbGRRdWVyeScpKG9wdGlvbnMpXHJcbiAgY29uc3QgZXJyb3JIYW5kbGVyID0gcmVxdWlyZSgnLi9lcnJvckhhbmRsZXInKShvcHRpb25zKVxyXG5cclxuICBmdW5jdGlvbiBmaW5kQnlJZCAoZmlsdGVyZWRDb250ZXh0LCBpZCkge1xyXG4gICAgcmV0dXJuIGZpbHRlcmVkQ29udGV4dC5maW5kT25lKCkuYW5kKHtcclxuICAgICAgW29wdGlvbnMuaWRQcm9wZXJ0eV06IGlkXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaXNEaXN0aW5jdEV4Y2x1ZGVkIChyZXEpIHtcclxuICAgIHJldHVybiBvcHRpb25zLmZpbHRlci5pc0V4Y2x1ZGVkKHJlcS5fZXJtUXVlcnlPcHRpb25zWydkaXN0aW5jdCddLCB7XHJcbiAgICAgIGFjY2VzczogcmVxLmFjY2VzcyxcclxuICAgICAgZXhjbHVkZWRNYXA6IGV4Y2x1ZGVkTWFwXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0SXRlbXMgKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICBpZiAoaXNEaXN0aW5jdEV4Y2x1ZGVkKHJlcSkpIHtcclxuICAgICAgcmVxLmVybS5yZXN1bHQgPSBbXVxyXG4gICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSAyMDBcclxuICAgICAgcmV0dXJuIG5leHQoKVxyXG4gICAgfVxyXG5cclxuICAgIG9wdGlvbnMuY29udGV4dEZpbHRlcihtb2RlbCwgcmVxLCAoZmlsdGVyZWRDb250ZXh0KSA9PiB7XHJcbiAgICAgIGJ1aWxkUXVlcnkoZmlsdGVyZWRDb250ZXh0LmZpbmQoKSwgcmVxLl9lcm1RdWVyeU9wdGlvbnMpLnRoZW4oKGl0ZW1zKSA9PiB7XHJcbiAgICAgICAgcmVxLmVybS5yZXN1bHQgPSBpdGVtc1xyXG4gICAgICAgIHJlcS5lcm0uc3RhdHVzQ29kZSA9IDIwMFxyXG5cclxuICAgICAgICBpZiAob3B0aW9ucy50b3RhbENvdW50SGVhZGVyICYmICFyZXEuX2VybVF1ZXJ5T3B0aW9uc1snZGlzdGluY3QnXSkge1xyXG4gICAgICAgICAgb3B0aW9ucy5jb250ZXh0RmlsdGVyKG1vZGVsLCByZXEsIChjb3VudEZpbHRlcmVkQ29udGV4dCkgPT4ge1xyXG4gICAgICAgICAgICBidWlsZFF1ZXJ5KGNvdW50RmlsdGVyZWRDb250ZXh0LmNvdW50KCksIF8uYXNzaWduKHJlcS5fZXJtUXVlcnlPcHRpb25zLCB7XHJcbiAgICAgICAgICAgICAgc2tpcDogMCxcclxuICAgICAgICAgICAgICBsaW1pdDogMFxyXG4gICAgICAgICAgICB9KSkudGhlbigoY291bnQpID0+IHtcclxuICAgICAgICAgICAgICByZXEuZXJtLnRvdGFsQ291bnQgPSBjb3VudFxyXG4gICAgICAgICAgICAgIG5leHQoKVxyXG4gICAgICAgICAgICB9LCBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbmV4dCgpXHJcbiAgICAgICAgfVxyXG4gICAgICB9LCBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldENvdW50IChyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgb3B0aW9ucy5jb250ZXh0RmlsdGVyKG1vZGVsLCByZXEsIChmaWx0ZXJlZENvbnRleHQpID0+IHtcclxuICAgICAgYnVpbGRRdWVyeShmaWx0ZXJlZENvbnRleHQuY291bnQoKSwgcmVxLl9lcm1RdWVyeU9wdGlvbnMpLnRoZW4oKGNvdW50KSA9PiB7XHJcbiAgICAgICAgcmVxLmVybS5yZXN1bHQgPSB7IGNvdW50OiBjb3VudCB9XHJcbiAgICAgICAgcmVxLmVybS5zdGF0dXNDb2RlID0gMjAwXHJcblxyXG4gICAgICAgIG5leHQoKVxyXG4gICAgICB9LCBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldFNoYWxsb3cgKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICBvcHRpb25zLmNvbnRleHRGaWx0ZXIobW9kZWwsIHJlcSwgKGZpbHRlcmVkQ29udGV4dCkgPT4ge1xyXG4gICAgICBidWlsZFF1ZXJ5KGZpbmRCeUlkKGZpbHRlcmVkQ29udGV4dCwgcmVxLnBhcmFtcy5pZCksIHJlcS5fZXJtUXVlcnlPcHRpb25zKS50aGVuKChpdGVtKSA9PiB7XHJcbiAgICAgICAgaWYgKCFpdGVtKSB7XHJcbiAgICAgICAgICByZXR1cm4gZXJyb3JIYW5kbGVyKHJlcSwgcmVzLCBuZXh0KShuZXcgRXJyb3IoaHR0cC5TVEFUVVNfQ09ERVNbNDA0XSkpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBwcm9wIGluIGl0ZW0pIHtcclxuICAgICAgICAgIGl0ZW1bcHJvcF0gPSB0eXBlb2YgaXRlbVtwcm9wXSA9PT0gJ29iamVjdCcgJiYgcHJvcCAhPT0gJ19pZCcgPyB0cnVlIDogaXRlbVtwcm9wXVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVxLmVybS5yZXN1bHQgPSBpdGVtXHJcbiAgICAgICAgcmVxLmVybS5zdGF0dXNDb2RlID0gMjAwXHJcblxyXG4gICAgICAgIG5leHQoKVxyXG4gICAgICB9LCBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGRlbGV0ZUl0ZW1zIChyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgb3B0aW9ucy5jb250ZXh0RmlsdGVyKG1vZGVsLCByZXEsIChmaWx0ZXJlZENvbnRleHQpID0+IHtcclxuICAgICAgYnVpbGRRdWVyeShmaWx0ZXJlZENvbnRleHQucmVtb3ZlKCksIHJlcS5fZXJtUXVlcnlPcHRpb25zKS50aGVuKCgpID0+IHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSAyMDRcclxuXHJcbiAgICAgICAgbmV4dCgpXHJcbiAgICAgIH0sIGVycm9ySGFuZGxlcihyZXEsIHJlcywgbmV4dCkpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0SXRlbSAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIGlmIChpc0Rpc3RpbmN0RXhjbHVkZWQocmVxKSkge1xyXG4gICAgICByZXEuZXJtLnJlc3VsdCA9IFtdXHJcbiAgICAgIHJlcS5lcm0uc3RhdHVzQ29kZSA9IDIwMFxyXG4gICAgICByZXR1cm4gbmV4dCgpXHJcbiAgICB9XHJcblxyXG4gICAgb3B0aW9ucy5jb250ZXh0RmlsdGVyKG1vZGVsLCByZXEsIChmaWx0ZXJlZENvbnRleHQpID0+IHtcclxuICAgICAgYnVpbGRRdWVyeShmaW5kQnlJZChmaWx0ZXJlZENvbnRleHQsIHJlcS5wYXJhbXMuaWQpLCByZXEuX2VybVF1ZXJ5T3B0aW9ucykudGhlbigoaXRlbSkgPT4ge1xyXG4gICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgcmV0dXJuIGVycm9ySGFuZGxlcihyZXEsIHJlcywgbmV4dCkobmV3IEVycm9yKGh0dHAuU1RBVFVTX0NPREVTWzQwNF0pKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVxLmVybS5yZXN1bHQgPSBpdGVtXHJcbiAgICAgICAgcmVxLmVybS5zdGF0dXNDb2RlID0gMjAwXHJcblxyXG4gICAgICAgIG5leHQoKVxyXG4gICAgICB9LCBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGRlbGV0ZUl0ZW0gKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICBpZiAob3B0aW9ucy5maW5kT25lQW5kUmVtb3ZlKSB7XHJcbiAgICAgIG9wdGlvbnMuY29udGV4dEZpbHRlcihtb2RlbCwgcmVxLCAoZmlsdGVyZWRDb250ZXh0KSA9PiB7XHJcbiAgICAgICAgZmluZEJ5SWQoZmlsdGVyZWRDb250ZXh0LCByZXEucGFyYW1zLmlkKS5maW5kT25lQW5kUmVtb3ZlKCkudGhlbigoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgaWYgKCFpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKG5ldyBFcnJvcihodHRwLlNUQVRVU19DT0RFU1s0MDRdKSlcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSAyMDRcclxuXHJcbiAgICAgICAgICBuZXh0KClcclxuICAgICAgICB9LCBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKVxyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVxLmVybS5kb2N1bWVudC5yZW1vdmUoKS50aGVuKCgpID0+IHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSAyMDRcclxuXHJcbiAgICAgICAgbmV4dCgpXHJcbiAgICAgIH0sIGVycm9ySGFuZGxlcihyZXEsIHJlcywgbmV4dCkpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVPYmplY3QgKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICByZXEuYm9keSA9IG9wdGlvbnMuZmlsdGVyLmZpbHRlck9iamVjdChyZXEuYm9keSB8fCB7fSwge1xyXG4gICAgICBhY2Nlc3M6IHJlcS5hY2Nlc3MsXHJcbiAgICAgIHBvcHVsYXRlOiByZXEuX2VybVF1ZXJ5T3B0aW9ucy5wb3B1bGF0ZVxyXG4gICAgfSlcclxuXHJcbiAgICBpZiAobW9kZWwuc2NoZW1hLm9wdGlvbnMuX2lkKSB7XHJcbiAgICAgIGRlbGV0ZSByZXEuYm9keS5faWRcclxuICAgIH1cclxuXHJcbiAgICBpZiAobW9kZWwuc2NoZW1hLm9wdGlvbnMudmVyc2lvbktleSkge1xyXG4gICAgICBkZWxldGUgcmVxLmJvZHlbbW9kZWwuc2NoZW1hLm9wdGlvbnMudmVyc2lvbktleV1cclxuICAgIH1cclxuXHJcbiAgICBtb2RlbC5jcmVhdGUocmVxLmJvZHkpLnRoZW4oKGl0ZW0pID0+IG1vZGVsLnBvcHVsYXRlKGl0ZW0sIHJlcS5fZXJtUXVlcnlPcHRpb25zLnBvcHVsYXRlIHx8IFtdKSkudGhlbigoaXRlbSkgPT4ge1xyXG4gICAgICByZXEuZXJtLnJlc3VsdCA9IGl0ZW1cclxuICAgICAgcmVxLmVybS5zdGF0dXNDb2RlID0gMjAxXHJcblxyXG4gICAgICBuZXh0KClcclxuICAgIH0sIGVycm9ySGFuZGxlcihyZXEsIHJlcywgbmV4dCkpXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBtb2RpZnlPYmplY3QgKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICByZXEuYm9keSA9IG9wdGlvbnMuZmlsdGVyLmZpbHRlck9iamVjdChyZXEuYm9keSB8fCB7fSwge1xyXG4gICAgICBhY2Nlc3M6IHJlcS5hY2Nlc3MsXHJcbiAgICAgIHBvcHVsYXRlOiByZXEuX2VybVF1ZXJ5T3B0aW9ucy5wb3B1bGF0ZVxyXG4gICAgfSlcclxuXHJcbiAgICBkZWxldGUgcmVxLmJvZHkuX2lkXHJcblxyXG4gICAgaWYgKG1vZGVsLnNjaGVtYS5vcHRpb25zLnZlcnNpb25LZXkpIHtcclxuICAgICAgZGVsZXRlIHJlcS5ib2R5W21vZGVsLnNjaGVtYS5vcHRpb25zLnZlcnNpb25LZXldXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZGVwb3B1bGF0ZSAoc3JjKSB7XHJcbiAgICAgIGxldCBkc3QgPSB7fVxyXG5cclxuICAgICAgZm9yIChsZXQga2V5IGluIHNyYykge1xyXG4gICAgICAgIGNvbnN0IHBhdGggPSBtb2RlbC5zY2hlbWEucGF0aChrZXkpXHJcblxyXG4gICAgICAgIGlmIChwYXRoICYmIHBhdGguY2FzdGVyICYmIHBhdGguY2FzdGVyLmluc3RhbmNlID09PSAnT2JqZWN0SUQnKSB7XHJcbiAgICAgICAgICBpZiAoXy5pc0FycmF5KHNyY1trZXldKSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNyY1trZXldLmxlbmd0aDsgKytqKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzcmNba2V5XVtqXSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIGRzdFtrZXldID0gZHN0W2tleV0gfHwge31cclxuICAgICAgICAgICAgICAgIGRzdFtrZXldW2pdID0gc3JjW2tleV1bal0uX2lkXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChzcmNba2V5XSkpIHtcclxuICAgICAgICAgICAgZHN0W2tleV0gPSBzcmNba2V5XS5faWRcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChzcmNba2V5XSkpIHtcclxuICAgICAgICAgIGlmIChwYXRoICYmIHBhdGguaW5zdGFuY2UgPT09ICdPYmplY3RJRCcpIHtcclxuICAgICAgICAgICAgZHN0W2tleV0gPSBzcmNba2V5XS5faWRcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRzdFtrZXldID0gZGVwb3B1bGF0ZShzcmNba2V5XSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGRzdFtrZXldKSkge1xyXG4gICAgICAgICAgZHN0W2tleV0gPSBzcmNba2V5XVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGRzdFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNsZWFuQm9keSA9IG1vcmVkb3RzKGRlcG9wdWxhdGUocmVxLmJvZHkpKVxyXG5cclxuICAgIGlmIChvcHRpb25zLmZpbmRPbmVBbmRVcGRhdGUpIHtcclxuICAgICAgb3B0aW9ucy5jb250ZXh0RmlsdGVyKG1vZGVsLCByZXEsIChmaWx0ZXJlZENvbnRleHQpID0+IHtcclxuICAgICAgICBmaW5kQnlJZChmaWx0ZXJlZENvbnRleHQsIHJlcS5wYXJhbXMuaWQpLmZpbmRPbmVBbmRVcGRhdGUoe30sIHtcclxuICAgICAgICAgICRzZXQ6IGNsZWFuQm9keVxyXG4gICAgICAgIH0sIHtcclxuICAgICAgICAgIG5ldzogdHJ1ZSxcclxuICAgICAgICAgIHJ1blZhbGlkYXRvcnM6IG9wdGlvbnMucnVuVmFsaWRhdG9yc1xyXG4gICAgICAgIH0pLmV4ZWMoKS50aGVuKChpdGVtKSA9PiBtb2RlbC5wb3B1bGF0ZShpdGVtLCByZXEuX2VybVF1ZXJ5T3B0aW9ucy5wb3B1bGF0ZSB8fCBbXSkpLnRoZW4oKGl0ZW0pID0+IHtcclxuICAgICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3JIYW5kbGVyKHJlcSwgcmVzLCBuZXh0KShuZXcgRXJyb3IoaHR0cC5TVEFUVVNfQ09ERVNbNDA0XSkpXHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgcmVxLmVybS5yZXN1bHQgPSBpdGVtXHJcbiAgICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSAyMDBcclxuXHJcbiAgICAgICAgICBuZXh0KClcclxuICAgICAgICB9LCBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKVxyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZm9yIChsZXQga2V5IGluIGNsZWFuQm9keSkge1xyXG4gICAgICAgIHJlcS5lcm0uZG9jdW1lbnQuc2V0KGtleSwgY2xlYW5Cb2R5W2tleV0pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlcS5lcm0uZG9jdW1lbnQuc2F2ZSgpLnRoZW4oKGl0ZW0pID0+IG1vZGVsLnBvcHVsYXRlKGl0ZW0sIHJlcS5fZXJtUXVlcnlPcHRpb25zLnBvcHVsYXRlIHx8IFtdKSkudGhlbigoaXRlbSkgPT4ge1xyXG4gICAgICAgIHJlcS5lcm0ucmVzdWx0ID0gaXRlbVxyXG4gICAgICAgIHJlcS5lcm0uc3RhdHVzQ29kZSA9IDIwMFxyXG5cclxuICAgICAgICBuZXh0KClcclxuICAgICAgfSwgZXJyb3JIYW5kbGVyKHJlcSwgcmVzLCBuZXh0KSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB7IGdldEl0ZW1zLCBnZXRDb3VudCwgZ2V0SXRlbSwgZ2V0U2hhbGxvdywgY3JlYXRlT2JqZWN0LCBtb2RpZnlPYmplY3QsIGRlbGV0ZUl0ZW1zLCBkZWxldGVJdGVtIH1cclxufVxyXG4iXX0=\n//# sourceMappingURL=operations.js.map"}